<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Variation by Climate – Headwater streamflow variability is amplified by drought</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ReferenceLowFlow.html" rel="next">
<link href="./SpaceTimeVar.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2ef01e258a497a70032e58193e2c5164.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-e84d0a51d8b171802d723e26b1748781.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
</head><body class="nav-sidebar floating"><a href="https://github.com/j-baldock/FlowVariabilityDrought" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#69b3a2; color:#fff; position: 

absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 

L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 

C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 

125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 

130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 

119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 

C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 

178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 

216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 

C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 

C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover 

.octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes 

octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media 

(max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner 

  .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>






<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./VarByClimate.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Variation by Climate</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Headwater streamflow variability is amplified by drought</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GatherFlowClimateData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Flow and Climate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SpaceTimeVar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatiotemporal Variation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./VarByClimate.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Variation by Climate</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ReferenceLowFlow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Low Flow Variation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ModeledQ_StreamStats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modeled Flow</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data"><span class="header-section-number">4.1</span> Data</a></li>
  <li><a href="#median-summer-flow" id="toc-median-summer-flow" class="nav-link" data-scroll-target="#median-summer-flow"><span class="header-section-number">4.2</span> Median summer flow</a></li>
  <li><a href="#distribution-and-variability" id="toc-distribution-and-variability" class="nav-link" data-scroll-target="#distribution-and-variability"><span class="header-section-number">4.3</span> Distribution and variability</a></li>
  <li><a href="#model-heterogeneity" id="toc-model-heterogeneity" class="nav-link" data-scroll-target="#model-heterogeneity"><span class="header-section-number">4.4</span> Model heterogeneity</a>
  <ul class="collapse">
  <li><a href="#fit-model" id="toc-fit-model" class="nav-link" data-scroll-target="#fit-model"><span class="header-section-number">4.4.1</span> Fit model</a></li>
  <li><a href="#sensitivity-analysis" id="toc-sensitivity-analysis" class="nav-link" data-scroll-target="#sensitivity-analysis"><span class="header-section-number">4.4.2</span> Sensitivity analysis</a></li>
  </ul></li>
  <li><a href="#paper-figs" id="toc-paper-figs" class="nav-link" data-scroll-target="#paper-figs"><span class="header-section-number">4.5</span> Paper figs</a>
  <ul class="collapse">
  <li><a href="#west-brook-2" id="toc-west-brook-2" class="nav-link" data-scroll-target="#west-brook-2"><span class="header-section-number">4.5.1</span> West Brook</a></li>
  <li><a href="#snake-river-1" id="toc-snake-river-1" class="nav-link" data-scroll-target="#snake-river-1"><span class="header-section-number">4.5.2</span> Snake River</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Variation by Climate</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Purpose:</strong> Quantify the effect of interannual variation in climatic conditions (water availability) on spatialy variability in headwater flow regimes.</p>
<section id="data" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="data"><span class="header-section-number">4.1</span> Data</h2>
<p>Site information</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>siteinfo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Data/EcoDrought_SiteInformation.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>siteinfo_sp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(siteinfo, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Little g’s (headwater sites)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat_clean <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Qualitative/LittleG_data_clean.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Big G’s (reference gages)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat_clean_big <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Qualitative/BigG_data_clean.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Water availability. In western, snowmelt-dominated basins, annual (water year) total yield is strongly related to summer total yield. But in eastern, rain-dominated basins, the relationship is much weaker, suggesting “faster” response to climate forcing in rain-dominated basins. Use total summer yield (percentile) as metric of interannual variation in water availability.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>wateravail <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Qualitative/BigG_wateravailability_annual.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(totalyield), <span class="sc">!</span><span class="fu">is.na</span>(totalyield_sum)) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tyz_perc =</span> <span class="fu">percentile</span>(totalyield_z),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tyz_sum_perc =</span> <span class="fu">percentile</span>(totalyield_sum_z)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tyz_perc =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tyz_perc), <span class="dv">0</span>, tyz_perc),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">tyz_sum_perc =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tyz_sum_perc), <span class="dv">0</span>, tyz_sum_perc))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>wateravail <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">!=</span> <span class="st">"Piney River"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Shields River"</span>, <span class="st">"Yellowstone River"</span>, basin)) <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">factor</span>(basin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Staunton River"</span>, <span class="st">"Paine Run"</span>, <span class="st">"Flathead"</span>, <span class="st">"Yellowstone River"</span>, <span class="st">"Snake River"</span>, <span class="st">"Donner Blitzen"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tyz_perc, <span class="at">y =</span> tyz_sum_perc)) <span class="sc">+</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Total annual yield (percentile)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Total summer yield (percentile)"</span>) <span class="sc">+</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>basin) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Order sites</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>wborder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"West Brook NWIS"</span>, <span class="st">"West Brook Lower"</span>, <span class="st">"Mitchell Brook"</span>, <span class="st">"Jimmy Brook"</span>, <span class="st">"Obear Brook Lower"</span>, <span class="st">"West Brook Upper"</span>, <span class="st">"West Brook Reservoir"</span>, <span class="st">"Sanderson Brook"</span>, <span class="st">"Avery Brook"</span>, <span class="st">"West Whately Brook"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>paineorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Paine Run 10"</span>, <span class="st">"Paine Run 08"</span>, <span class="st">"Paine Run 07"</span>, <span class="st">"Paine Run 06"</span>, <span class="st">"Paine Run 02"</span>, <span class="st">"Paine Run 01"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>stauntorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Staunton River 10"</span>, <span class="st">"Staunton River 09"</span>, <span class="st">"Staunton River 07"</span>, <span class="st">"Staunton River 06"</span>, <span class="st">"Staunton River 03"</span>, <span class="st">"Staunton River 02"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>flatorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BigCreekLower"</span>, <span class="st">"LangfordCreekLower"</span>, <span class="st">"LangfordCreekUpper"</span>, <span class="st">"Big Creek NWIS"</span>, <span class="st">"BigCreekUpper"</span>, <span class="st">"HallowattCreekLower"</span>, <span class="st">"NicolaCreek"</span>, <span class="st">"WernerCreek"</span>, <span class="st">"Hallowat Creek NWIS"</span>, <span class="st">"CoalCreekLower"</span>, <span class="st">"CycloneCreekLower"</span>, <span class="st">"CycloneCreekMiddle"</span>, <span class="st">"CycloneCreekUpper"</span>, <span class="st">"CoalCreekMiddle"</span>, <span class="st">"CoalCreekNorth"</span>, <span class="st">"CoalCreekHeadwaters"</span>, <span class="st">"McGeeCreekLower"</span>, <span class="st">"McGeeCreekTrib"</span>, <span class="st">"McGeeCreekUpper"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>yellorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Shields River Valley Ranch"</span>, <span class="st">"Deep Creek"</span>, <span class="st">"Crandall Creek"</span>, <span class="st">"Buck Creek"</span>, <span class="st">"Dugout Creek"</span>, <span class="st">"Shields River ab Dugout"</span>, <span class="st">"Lodgepole Creek"</span>, <span class="st">"EF Duck Creek be HF"</span>, <span class="st">"EF Duck Creek ab HF"</span>, <span class="st">"Henrys Fork"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>snakeorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Spread Creek Dam"</span>, <span class="st">"Rock Creek"</span>, <span class="st">"NF Spread Creek Lower"</span>, <span class="st">"NF Spread Creek Upper"</span>, <span class="st">"Grizzly Creek"</span>, <span class="st">"SF Spread Creek Lower"</span>, <span class="st">"Grouse Creek"</span>, <span class="st">"SF Spread Creek Upper"</span>, <span class="st">"Leidy Creek Mouth"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>donnerorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fish Creek NWIS"</span>, <span class="st">"Donner Blitzen ab Fish NWIS"</span>, <span class="st">"Donner Blitzen nr Burnt Car NWIS"</span>, <span class="st">"Donner Blitzen ab Indian NWIS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get catchment shapefiles</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sheds_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>myfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(myfiles)) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  sheds_list[[i]] <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/"</span>, myfiles[i], <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>sheds <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, sheds_list) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_id =</span> <span class="fu">ifelse</span>(site_id <span class="sc">==</span> <span class="st">"SP01"</span>, <span class="st">"SP07"</span>, <span class="fu">ifelse</span>(site_id <span class="sc">==</span> <span class="st">"SP07"</span>, <span class="st">"SP01"</span>, site_id))) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(siteinfo)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#mapview(sheds %&gt;% arrange(desc(area_sqmi)), alpha.regions = 0.2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="median-summer-flow" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="median-summer-flow"><span class="header-section-number">4.2</span> Median summer flow</h2>
<p>Plot maps of median summer flow across years/networks</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">West Brook</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Paine Run</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Staunton River</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Flathead</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Yellowstone</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">Snake</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false">Donner Blitzen</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"West Brook"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> wborder</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2020</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sheds and network</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Mass_Watersheds.shp"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"WBR"</span>,]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Mass_Streams.shp"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># get lakes</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">get_waterbodies</span>(<span class="at">AOI =</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"West Brook NWIS"</span>), <span class="at">buffer =</span> <span class="dv">10000</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> lakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gnis_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Northampton Reservoir Upper"</span>, <span class="st">"Northampton Reservoir"</span>))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(lakes, "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Study area maps/lakes/lakes_WestBrook.shp")</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># little g points</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> wborder) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> wborder))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>))</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate variability for reference gage</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate long-term median of summer median flow, to center color scheme</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>annmed_big <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>annmed_big <span class="ot">&lt;-</span> <span class="fu">median</span>(annmed_big<span class="sc">$</span>medlogYield)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>plotlist_wb <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>  plotlist_wb[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>      <span class="co">#scale_fill_gradientn(colours = rev(hcl.colors(100, "Zissou1")), limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>      <span class="co">#scale_fill_gradientn(colours = cet_pal(100, name = "l16"), limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> lakes, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"lightskyblue1"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> lakes, <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">fill =</span> <span class="st">"lightskyblue1"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"label"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste</span>(pedat<span class="sc">$</span>WaterYear[i], <span class="st">" ("</span>, pedat<span class="sc">$</span>tyz_sum_perc[i], <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">vjust =</span> <span class="fl">1.15</span>, <span class="at">hjust =</span> <span class="fl">1.05</span>, <span class="at">size =</span> <span class="dv">5</span>)})</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_wb, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Paine Run"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> paineorder</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2022</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Shen_Watersheds.shp"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"PA_10FL"</span>,]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Shen_Streams.shp"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># hillshade</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>myrast <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Data/Spatial data/Elevation/Shenandoah_DEM_10m_nc.tif"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>myrast <span class="ot">&lt;-</span> <span class="fu">mask</span>(<span class="fu">crop</span>(myrast, mysheds), mysheds)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>slo <span class="ot">&lt;-</span> <span class="fu">terrain</span>(myrast, <span class="st">"slope"</span>, <span class="at">unit =</span> <span class="st">"radians"</span>) </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>asp <span class="ot">&lt;-</span> <span class="fu">terrain</span>(myrast, <span class="st">"aspect"</span>, <span class="at">unit =</span> <span class="st">"radians"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>hill <span class="ot">&lt;-</span> <span class="fu">shade</span>(<span class="at">slope =</span> slo, <span class="at">aspect =</span> asp, <span class="at">angle =</span> <span class="dv">40</span>, <span class="at">direction =</span> <span class="dv">270</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>hilldf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(hill, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># little g points</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>plotlist_pa <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  plotlist_pa[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste</span>(pedat<span class="sc">$</span>WaterYear[i], <span class="st">" ("</span>, pedat<span class="sc">$</span>tyz_sum_perc[i], <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">vjust =</span> <span class="fl">1.15</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="dv">5</span>)})</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_pa, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Staunton River"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> stauntorder</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2022</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Shen_Watersheds.shp"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"SR_10FL"</span>,]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Shen_Streams.shp"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># little g points</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>plotlist_st <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  plotlist_st[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"label"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste</span>(pedat<span class="sc">$</span>WaterYear[i], <span class="st">" ("</span>, pedat<span class="sc">$</span>tyz_sum_perc[i], <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">vjust =</span> <span class="fl">1.15</span>, <span class="at">hjust =</span> <span class="fl">1.05</span>, <span class="at">size =</span> <span class="dv">5</span>)})</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_st, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Flathead"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> flatorder</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2018</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Flat_Watersheds.shp"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"NFF"</span>,]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Flat_Streams.shp"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get lakes</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">get_waterbodies</span>(<span class="at">AOI =</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"North Fork Flathead River NWIS"</span>), <span class="at">buffer =</span> <span class="dv">100000</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(lakes, <span class="fu">crs</span>(mysheds))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(lakes, <span class="fu">st_as_sf</span>(mysheds))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> lakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gnis_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Moose Lake"</span>, <span class="st">"Mud Lake"</span>))</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># points</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> flatorder) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> flatorder))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"BigCreekUpper"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">114.31506</span>, <span class="fl">48.57672</span>))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"HallowattCreekLower"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">114.31914</span>, <span class="fl">48.57256</span>))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>plotlist_fl <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>  plotlist_fl[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"label"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste</span>(pedat<span class="sc">$</span>WaterYear[i], <span class="st">" ("</span>, pedat<span class="sc">$</span>tyz_sum_perc[i], <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">vjust =</span> <span class="fl">1.15</span>, <span class="at">hjust =</span> <span class="fl">1.05</span>, <span class="at">size =</span> <span class="dv">5</span>)})</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_fl, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Shields River"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> yellorder</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2020</span>,<span class="dv">2022</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Shields_Watersheds.shp"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SRS"</span>, <span class="st">"DU01"</span>),]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Shields_Streams.shp"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># points</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr)) <span class="co">#%&gt;% filter(subbasin != "Duck Creek")</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>plotlist_ye <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  plotlist_ye[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste</span>(pedat<span class="sc">$</span>WaterYear[i], <span class="st">" ("</span>, pedat<span class="sc">$</span>tyz_sum_perc[i], <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.15</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="dv">5</span>)})</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_ye, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Snake River"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> snakeorder</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Snake_Watersheds.shp"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"SP11"</span>,]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Snake_Streams.shp"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get lakes</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">get_waterbodies</span>(<span class="at">AOI =</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Spread Creek Dam"</span>), <span class="at">buffer =</span> <span class="dv">100000</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(lakes, <span class="fu">crs</span>(mysheds))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(lakes, <span class="fu">st_as_sf</span>(mysheds))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> lakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gnis_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Leidy Lake"</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># points</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> snakeorder) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> snakeorder))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># edit geometry to reduce overlap</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"SF Spread Creek Lower NWIS"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.32226</span>, <span class="fl">43.76118</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"NF Spread Creek Lower"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.3199</span>, <span class="fl">43.766533</span>))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"Grizzly Creek"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.23289</span>, <span class="fl">43.77433</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"NF Spread Creek Upper"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.23405</span>, <span class="fl">43.77227</span>))</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"SF Spread Creek Upper"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.31475</span>, <span class="fl">43.73661</span>))</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>plotlist_sn <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  plotlist_sn[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste</span>(pedat<span class="sc">$</span>WaterYear[i], <span class="st">" ("</span>, pedat<span class="sc">$</span>tyz_sum_perc[i], <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.15</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="dv">5</span>)})</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_sn, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Donner Blitzen"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> <span class="fu">c</span>(donnerorder, <span class="st">"Donner Blitzen River nr Frenchglen NWIS"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Oreg_Watersheds.shp"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"DBF"</span>,]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Oreg_Streams.shp"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># points</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> donnerorder))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># edit geometry to reduce overlap</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"Donner Blitzen ab Fish NWIS"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">118.84315</span>, <span class="fl">42.75476</span>))</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"Fish Creek"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">118.83173</span>, <span class="fl">42.75911</span>))</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(tempdat_big <span class="sc">%&gt;%</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>())</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>plotlist_db <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>  plotlist_db[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste</span>(pedat<span class="sc">$</span>WaterYear[i], <span class="st">" ("</span>, pedat<span class="sc">$</span>tyz_sum_perc[i], <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.15</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="dv">5</span>)})</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_db, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="distribution-and-variability" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="distribution-and-variability"><span class="header-section-number">4.3</span> Distribution and variability</h2>
<p>Create function to plot interannual distribution of streamflow values, annual distributions of streamflow values, and scatterplot plot of spatial streamflow heterogeneity by water availability</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>portfolioplot <span class="ot">&lt;-</span> <span class="cf">function</span>(bas, orderr, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"interann"</span>, <span class="st">"annual"</span>, <span class="st">"scatter"</span>), wtryrs) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter data</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate relative variation</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># interannual</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  pint <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled.., <span class="at">color =</span> site_name, <span class="at">fill =</span> site_name), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>)) <span class="sc">+</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>), <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat_big, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled..), <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"grey40"</span>, <span class="fl">0.2</span>), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Summer log(Yield, mm/day)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Scaled density"</span>) <span class="sc">+</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annual</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  pann <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled.., <span class="at">color =</span> site_name, <span class="at">fill =</span> site_name), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>)) <span class="sc">+</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>), <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat_big, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled..), <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"grey40"</span>, <span class="fl">0.2</span>), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Summer log(Yield, mm/day)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Scaled density"</span>) <span class="sc">+</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">factor</span>(WaterYear, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(totalyield_sum_z) <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))))</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># portfolio effect by water availability</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  ppew <span class="ot">&lt;-</span> pedat <span class="sc">%&gt;%</span> </span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_range, <span class="at">label =</span> wylab)) <span class="sc">+</span> </span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">0</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"skyblue1"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Water availability"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Relative difference in range"</span>) <span class="sc">+</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span>     </span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Water year"</span>)) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">100</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">450</span>)</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"interannual"</span>) { <span class="fu">return</span>(pint) }</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"annual"</span>) { <span class="fu">return</span>(pann) }</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"scatter"</span>) { <span class="fu">return</span>(ppew) }</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"table"</span>) { <span class="fu">return</span>(pedat) }</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Generate plots</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">West Brook</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Paine Run</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Staunton River</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Flathead</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Yellowstone</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Snake River</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">Donner Blitzen</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>denwb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>denpa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>denst</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>denfl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>denye</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>densn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dendb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="model-heterogeneity" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="model-heterogeneity"><span class="header-section-number">4.4</span> Model heterogeneity</h2>
<p>How does regional water availability affect spatial streamflow heterogeneity (relative difference range of streamflow values, headwaters vs.&nbsp;reference gages)?</p>
<p>Set color palette</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">7</span>, <span class="st">"Set2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Some data manipulation</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define basin-years to keep</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>keepyears <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"West Brook"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2020</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Paine Run"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2022</span>)),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Staunton River"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2022</span>)),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Flathead"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2018</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Shields River"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2020</span>,<span class="dv">2022</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Snake River"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Donner Blitzen"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">keep =</span> <span class="st">"yes"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># standard deviation of median summer flow</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># dat_clean %&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(basin, site_name, WaterYear) %&gt;%</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(medyield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(basin, WaterYear) %&gt;%</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(sdyield = sd(medyield), nsites = n()) %&gt;%</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(wateravail %&gt;% select(basin, WaterYear, totalyield:tyz_sum_perc)) %&gt;%</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(keepyears) %&gt;% filter(keep == "yes") %&gt;%</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(basin = ifelse(basin == "Shields River", "Yellowstone River",</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ifelse(basin == "Flathead", "Flathead River", basin))) %&gt;%</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(basin = factor(basin, levels = c("West Brook", "Piney River", "Staunton River", "Paine Run", "Flathead River", "Yellowstone River", "Snake River", "Donner Blitzen"))) %&gt;%</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = tyz_sum_perc, y = sdyield)) +</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_smooth(method = "lm", color = "black", aes(weight = nsites)) +</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(aes(fill = basin, size = nsites), shape = 21) +</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set2") +</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   #facet_wrap(~basin) +</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw() + theme(panel.grid = element_blank())</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative difference in range as above</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>mydat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat_clean_big <span class="sc">%&gt;%</span> </span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield<span class="sc">:</span>tyz_sum_perc)) <span class="sc">%&gt;%</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(keepyears) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(keep <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Shields River"</span>, <span class="st">"Yellowstone River"</span>,</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Flathead"</span>, <span class="st">"Flathead River"</span>, </span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Donner Blitzen"</span>, <span class="st">"Donner-Blitzen River"</span>, basin)))) <span class="sc">%&gt;%</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">factor</span>(basin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Staunton River"</span>, <span class="st">"Paine Run"</span>, </span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Flathead River"</span>, <span class="st">"Yellowstone River"</span>, <span class="st">"Snake River"</span>, <span class="st">"Donner-Blitzen River"</span>))) </span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>mydat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 14
   basin     WaterYear nsites littlerange bigrange pe_range site_name totalyield
   &lt;fct&gt;         &lt;dbl&gt;  &lt;int&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
 1 Donner-B…      2019      4       0.332    0.583    -43.1 Donner B…       278.
 2 Donner-B…      2020      4       0.605    0.516     17.3 Donner B…       152.
 3 Donner-B…      2021      4       0.474    0.336     41.1 Donner B…       122.
 4 Donner-B…      2022      4       0.741    0.597     24.0 Donner B…       125.
 5 Flathead…      2018     18       1.82     0.783    133.  North Fo…       654.
 6 Flathead…      2019     19       2.47     0.668    269.  North Fo…       448.
 7 Flathead…      2020     19       3.49     1.11     214.  North Fo…       605.
 8 Flathead…      2021     17       2.76     0.756    265.  North Fo…       483.
 9 Flathead…      2022     16       2.76     1.11     149.  North Fo…       793.
10 Flathead…      2023      9       1.94     0.451    331.  North Fo…       372.
# ℹ 28 more rows
# ℹ 6 more variables: totalyield_z &lt;dbl&gt;, totalyield_sum &lt;dbl&gt;,
#   totalyield_sum_z &lt;dbl&gt;, tyz_perc &lt;dbl&gt;, tyz_sum_perc &lt;dbl&gt;, keep &lt;chr&gt;</code></pre>
</div>
</div>
<p>Show simple linear model summary, weighted by number of sites</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(pe_range <span class="sc">~</span> tyz_sum_perc, <span class="at">data =</span> mydat, <span class="at">weights =</span> nsites))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = pe_range ~ tyz_sum_perc, data = mydat, weights = nsites)

Weighted Residuals:
    Min      1Q  Median      3Q     Max 
-503.62 -205.22  -25.09  108.84  639.45 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  239.1231    26.7291   8.946 1.12e-10 ***
tyz_sum_perc  -1.8174     0.5199  -3.496  0.00127 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 262.6 on 36 degrees of freedom
Multiple R-squared:  0.2534,    Adjusted R-squared:  0.2327 
F-statistic: 12.22 on 1 and 36 DF,  p-value: 0.001273</code></pre>
</div>
</div>
<p>Show distribution of spatial streamflow heterogeneity by basin. Lots of structuring by basin, driven in large part by Staunton and Donner-Blitzen Rivers.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(pe_range <span class="sc">~</span> basin, <span class="at">data =</span> mydat, <span class="at">ylab =</span> <span class="st">"Spatial streamflow heterogeneity"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">las =</span> <span class="dv">2</span>, <span class="at">col =</span> mycols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="fit-model" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="fit-model"><span class="header-section-number">4.4.1</span> Fit model</h3>
<p>Use a random slope/random intercept mixed effects model to estimate the among-basin mean effect of regional water availability on spatial streamflow heterogeneity.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>This regression is not weighted by number of headwater sites used to calculate spatial heterogeneity because variance decomposition using <em>rptR</em> does not support use of weights.</li>
<li>This uses z-scored x-values…using the raw percentiles leads to model convergence issues</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mydat <span class="ot">&lt;-</span> mydat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">scale</span>(tyz_sum_perc))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(pe_range <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: pe_range ~ z_tyz_sum_perc + (1 + z_tyz_sum_perc | basin)
   Data: mydat

REML criterion at convergence: 430.4

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.5512 -0.4206 -0.1253  0.2584  2.8102 

Random effects:
 Groups   Name           Variance Std.Dev. Corr 
 basin    (Intercept)    7810.1   88.37         
          z_tyz_sum_perc  609.8   24.69    -0.92
 Residual                5127.9   71.61         
Number of obs: 38, groups:  basin, 7

Fixed effects:
               Estimate Std. Error     df t value Pr(&gt;|t|)  
(Intercept)      133.13      35.60   5.51   3.740   0.0113 *
z_tyz_sum_perc   -45.39      16.29   3.62  -2.787   0.0554 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr)
z_tyz_sm_pr -0.521</code></pre>
</div>
</div>
<p>Get p-values for global slope and intercept: (doesn’t to run in Quarto…works fine in R)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(<span class="fu">as_lmerModLmerTest</span>(lmod)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                Estimate Std. Error       df   t value   Pr(&gt;|t|)
(Intercept)    133.13376   35.60169 5.510014  3.739534 0.01125212
z_tyz_sum_perc -45.39251   16.28830 3.620345 -2.786817 0.05538425</code></pre>
</div>
</div>
<p>Plot relationship between spatial streamflow heterogeneity and regional water availability with global (among-population mean) regression line.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get predicted values and 95% credible interval</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>effects_tyz <span class="ot">&lt;-</span> effects<span class="sc">::</span><span class="fu">effect</span>(<span class="at">term =</span> <span class="st">"z_tyz_sum_perc"</span>, <span class="at">mod =</span> <span class="fu">as_lmerModLmerTest</span>(lmod), <span class="at">xlevels =</span> <span class="fu">list</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">seq</span>(<span class="fu">min</span>(mydat<span class="sc">$</span>z_tyz_sum_perc), <span class="fu">max</span>(mydat<span class="sc">$</span>z_tyz_sum_perc), <span class="at">length.out =</span> <span class="dv">1000</span>)), <span class="at">se =</span> <span class="fu">list</span>(<span class="at">level =</span> <span class="fl">0.95</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>x_tyz <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(effects_tyz) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tyz_sum_perc =</span> (z_tyz_sum_perc <span class="sc">*</span> <span class="fu">attr</span>(mydat<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:scale"</span>)) <span class="sc">+</span> <span class="fu">attr</span>(mydat<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:center"</span>))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># trim data for panel labesl</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>mydat_labs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mydat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"West Brook"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>)),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                        mydat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"Snake River"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labs =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>randiffplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mydat, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_range, <span class="at">fill =</span> basin, <span class="at">size =</span> nsites), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> mydat_labs, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_range, <span class="at">label =</span> labs), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Spatial streamflow heterogeneity (percent difference)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Water availability (percentile)"</span>) <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Basin"</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">order =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Number of sites"</span>, <span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>randiffplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write to file</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_RangeDiff_allsites2.jpg", width = 4.75, height = 5, units = "in", res = 1000)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># randiffplot</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Use <em>rptR</em> to decompose variance in spatial streamflow heterogeneity into fixed (regional water availability) and random (basin) effect sources:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>rmod <span class="ot">&lt;-</span> <span class="fu">rptGaussian</span>(pe_range <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat, <span class="at">grname =</span> <span class="fu">c</span>(<span class="st">"basin"</span>, <span class="st">"Fixed"</span>), <span class="at">ratio =</span> <span class="cn">TRUE</span>, <span class="at">adjusted =</span> <span class="cn">FALSE</span>, <span class="at">nboot =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap Progress:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

Repeatability estimation using the lmm method 

Repeatability for basin
R  = 0.539
SE = 0.171
CI = [0.16, 0.813]
P  = 0.00764 [LRT]
     NA [Permutation]

Repeatability for Fixed
R  = 0.132
SE = 0.101
CI = [0.013, 0.392]
P  = NA [LRT]
     NA [Permutation]</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rmod<span class="sc">$</span>mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: pe_range ~ z_tyz_sum_perc + (1 + z_tyz_sum_perc | basin)
   Data: data
REML criterion at convergence: 430.4229
Random effects:
 Groups   Name           Std.Dev. Corr 
 basin    (Intercept)    88.37         
          z_tyz_sum_perc 24.69    -0.92
 Residual                71.61         
Number of obs: 38, groups:  basin, 7
Fixed Effects:
   (Intercept)  z_tyz_sum_perc  
        133.13          -45.39  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmod, <span class="at">grname =</span> <span class="st">"basin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmod, <span class="at">grname =</span> <span class="st">"Fixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The strong effect of basin is largely driven by Staunton and Donner-Blitzen Rivers. Without those basins, random effect variance shrinks and fixed effect variance expands considerably. Much of this pattern is likely due to low sample sizes (few headwater gages in these basins, particularly in the Donner-Blitzen)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>rmod <span class="ot">&lt;-</span> <span class="fu">rptGaussian</span>(pe_range <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>basin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Staunton River"</span>, <span class="st">"Donner-Blitzen River"</span>)), <span class="at">grname =</span> <span class="fu">c</span>(<span class="st">"basin"</span>, <span class="st">"Fixed"</span>), <span class="at">ratio =</span> <span class="cn">TRUE</span>, <span class="at">adjusted =</span> <span class="cn">FALSE</span>, <span class="at">nboot =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap Progress:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

Repeatability estimation using the lmm method 

Repeatability for basin
R  = 0.037
SE = 0.114
CI = [0, 0.409]
P  = 1 [LRT]
     NA [Permutation]

Repeatability for Fixed
R  = 0.304
SE = 0.128
CI = [0.066, 0.563]
P  = NA [LRT]
     NA [Permutation]</code></pre>
</div>
</div>
</section>
<section id="sensitivity-analysis" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="sensitivity-analysis"><span class="header-section-number">4.4.2</span> Sensitivity analysis</h3>
<p>How sensitive are these results to the choice of data (log) transformation, per comments from John Hammond during USGS internal review?</p>
<p>Summary: While the among-network mean effect of water availability on heterogeneity was less significant using un-logged discharge data (p &gt; 0.05), this appeared to be driven by the highly non-normal distribution of raw discharge values, as the reviewer indicated. Importantly, the magnitude of the effect is similar and the qualitative results are unchanged (negative slope).</p>
<p>Data manipulation: use un-logged/raw Yield data to calculation spatial heterogeneity, also use CV rather than ranges</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mydat2 <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(Yield_mm)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(Yield_mm)[<span class="dv">1</span>],</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlecv =</span> <span class="fu">sd</span>(Yield_mm)<span class="sc">/</span><span class="fu">mean</span>(Yield_mm)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat_clean_big <span class="sc">%&gt;%</span> </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(Yield_mm)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(Yield_mm)[<span class="dv">1</span>],</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">bigcv =</span> <span class="fu">sd</span>(Yield_mm)<span class="sc">/</span><span class="fu">mean</span>(Yield_mm)) <span class="sc">%&gt;%</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_cv =</span> ((littlecv<span class="sc">-</span>bigcv)<span class="sc">/</span>bigcv)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield<span class="sc">:</span>tyz_sum_perc)) <span class="sc">%&gt;%</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(keepyears) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(keep <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Shields River"</span>, <span class="st">"Yellowstone River"</span>,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Flathead"</span>, <span class="st">"Flathead River"</span>, </span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Donner Blitzen"</span>, <span class="st">"Donner-Blitzen River"</span>, basin)))) <span class="sc">%&gt;%</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">factor</span>(basin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Staunton River"</span>, <span class="st">"Paine Run"</span>, </span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Flathead River"</span>, <span class="st">"Yellowstone River"</span>, <span class="st">"Snake River"</span>, <span class="st">"Donner-Blitzen River"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="range-un-logged" class="level4" data-number="4.4.2.1">
<h4 data-number="4.4.2.1" class="anchored" data-anchor-id="range-un-logged"><span class="header-section-number">4.4.2.1</span> Range, un-logged</h4>
<p>Fit the mixed effects model</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mydat2 <span class="ot">&lt;-</span> mydat2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">scale</span>(tyz_sum_perc))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(pe_range <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat2)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: pe_range ~ z_tyz_sum_perc + (1 + z_tyz_sum_perc | basin)
   Data: mydat2

REML criterion at convergence: 523.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.8092 -0.4147 -0.1069  0.3663  3.7590 

Random effects:
 Groups   Name           Variance Std.Dev. Corr 
 basin    (Intercept)    79567    282.1         
          z_tyz_sum_perc 19495    139.6    -1.00
 Residual                70913    266.3         
Number of obs: 38, groups:  basin, 7

Fixed effects:
               Estimate Std. Error      df t value Pr(&gt;|t|)
(Intercept)     238.131    116.273   4.215   2.048    0.106
z_tyz_sum_perc  -86.826     72.670   2.761  -1.195    0.325

Correlation of Fixed Effects:
            (Intr)
z_tyz_sm_pr -0.703
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
<p>Plot</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get predicted values and 95% credible interval</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>effects_tyz <span class="ot">&lt;-</span> effects<span class="sc">::</span><span class="fu">effect</span>(<span class="at">term =</span> <span class="st">"z_tyz_sum_perc"</span>, <span class="at">mod =</span> <span class="fu">as_lmerModLmerTest</span>(lmod), <span class="at">xlevels =</span> <span class="fu">list</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">seq</span>(<span class="fu">min</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="fu">max</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="at">length.out =</span> <span class="dv">1000</span>)), <span class="at">se =</span> <span class="fu">list</span>(<span class="at">level =</span> <span class="fl">0.95</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>x_tyz <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(effects_tyz) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tyz_sum_perc =</span> (z_tyz_sum_perc <span class="sc">*</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:scale"</span>)) <span class="sc">+</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:center"</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># trim data for panel labesl</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>mydat_labs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"West Brook"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>)),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                        mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"Snake River"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labs =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>))</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mydat2, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_range, <span class="at">fill =</span> basin, <span class="at">size =</span> nsites), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Spatial streamflow heterogeneity (percent difference)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Water availability (percentile)"</span>) <span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Basin"</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">order =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Number of sites"</span>, <span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cv" class="level4" data-number="4.4.2.2">
<h4 data-number="4.4.2.2" class="anchored" data-anchor-id="cv"><span class="header-section-number">4.4.2.2</span> CV</h4>
<p>Fig the mmixed effects model</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mydat2 <span class="ot">&lt;-</span> mydat2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">scale</span>(tyz_sum_perc))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(pe_cv <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat2)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: pe_cv ~ z_tyz_sum_perc + (1 + z_tyz_sum_perc | basin)
   Data: mydat2

REML criterion at convergence: 450.7

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.4210 -0.3359  0.0006  0.2983  3.9794 

Random effects:
 Groups   Name           Variance Std.Dev. Corr 
 basin    (Intercept)    24752    157.33        
          z_tyz_sum_perc  8948     94.59   -1.00
 Residual                 7991     89.39        
Number of obs: 38, groups:  basin, 7

Fixed effects:
               Estimate Std. Error      df t value Pr(&gt;|t|)
(Intercept)      88.405     61.551   5.248   1.436    0.208
z_tyz_sum_perc  -55.189     39.739   3.675  -1.389    0.243

Correlation of Fixed Effects:
            (Intr)
z_tyz_sm_pr -0.889
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
<p>Plot</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get predicted values and 95% credible interval</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>effects_tyz <span class="ot">&lt;-</span> effects<span class="sc">::</span><span class="fu">effect</span>(<span class="at">term =</span> <span class="st">"z_tyz_sum_perc"</span>, <span class="at">mod =</span> <span class="fu">as_lmerModLmerTest</span>(lmod), <span class="at">xlevels =</span> <span class="fu">list</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">seq</span>(<span class="fu">min</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="fu">max</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="at">length.out =</span> <span class="dv">1000</span>)), <span class="at">se =</span> <span class="fu">list</span>(<span class="at">level =</span> <span class="fl">0.95</span>))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>x_tyz <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(effects_tyz) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tyz_sum_perc =</span> (z_tyz_sum_perc <span class="sc">*</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:scale"</span>)) <span class="sc">+</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:center"</span>))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># trim data for panel labesl</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>mydat_labs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"West Brook"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>)),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                        mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"Snake River"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labs =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mydat2, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_cv, <span class="at">fill =</span> basin, <span class="at">size =</span> nsites), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Spatial streamflow heterogeneity (percent difference)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Water availability (percentile)"</span>) <span class="sc">+</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Basin"</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">order =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Number of sites"</span>, <span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="paper-figs" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="paper-figs"><span class="header-section-number">4.5</span> Paper figs</h2>
<section id="west-brook-2" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="west-brook-2"><span class="header-section-number">4.5.1</span> West Brook</h3>
<p>2020/2021 summer flow distributions</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"West Brook"</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> wborder</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># annual</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>pann <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled.., <span class="at">color =</span> site_name, <span class="at">fill =</span> site_name), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>)) <span class="sc">+</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>), <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat_big, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled..), <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"grey40"</span>, <span class="fl">0.2</span>), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Summer log(Yield, mm/day)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">strip.background =</span> <span class="fu">element_blank</span>(), <span class="at">strip.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">factor</span>(WaterYear, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(totalyield_sum_z) <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pann)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="264"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summerdensity_WB_annual.jpg", width = 2.75, height = 5, units = "in", res = 1000)</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pann</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>2020/2021 summer flow distributions</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"West Brook"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> wborder</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sheds and network</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Mass_Watersheds.shp"</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"WBR"</span>,]</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Mass_Streams.shp"</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co"># get lakes</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">get_waterbodies</span>(<span class="at">AOI =</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"West Brook NWIS"</span>), <span class="at">buffer =</span> <span class="dv">10000</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> lakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gnis_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Northampton Reservoir Upper"</span>, <span class="st">"Northampton Reservoir"</span>))</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co"># little g points</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> wborder) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> wborder))</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a>plotlist_wb <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>  plotlist_wb[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> lakes, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"lightskyblue1"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> lakes, <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">fill =</span> <span class="st">"lightskyblue1"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.003</span>, <span class="fl">0.003</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.002</span>, <span class="fl">0.002</span>))</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a>      <span class="co">#annotate("label", x = Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = 1.05, size = 5)</span></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_wb, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summermedianmap_WB_annual.jpg", width = 4, height = 6, units = "in", res = 1000)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># p</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="snake-river-1" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="snake-river-1"><span class="header-section-number">4.5.2</span> Snake River</h3>
<p>2021/2022 summer flow distributions</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Snake River"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> snakeorder</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co"># annual</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>pann <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled.., <span class="at">color =</span> site_name, <span class="at">fill =</span> site_name), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>)) <span class="sc">+</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>), <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat_big, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled..), <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"grey40"</span>, <span class="fl">0.2</span>), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Summer log(Yield, mm/day)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">strip.background =</span> <span class="fu">element_blank</span>(), <span class="at">strip.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">factor</span>(WaterYear, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(totalyield_sum_z) <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pann)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="264"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summerdensity_Snake_annual.jpg", width = 2.75, height = 5, units = "in", res = 1000)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pann</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>2022/2022 summer flow distributions</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bas <span class="ot">&lt;-</span> <span class="st">"Snake River"</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>orderr <span class="ot">&lt;-</span> snakeorder</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>wtryrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Snake_Watersheds.shp"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>mysheds <span class="ot">&lt;-</span> mysheds[mysheds<span class="sc">$</span>site_id <span class="sc">==</span> <span class="st">"SP11"</span>,]</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Snake_Streams.shp"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(mynet) <span class="ot">&lt;-</span> <span class="fu">crs</span>(mysheds)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>mynet <span class="ot">&lt;-</span> <span class="fu">crop</span>(mynet, mysheds)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get lakes</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">get_waterbodies</span>(<span class="at">AOI =</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Spread Creek Dam"</span>), <span class="at">buffer =</span> <span class="dv">100000</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(lakes, <span class="fu">crs</span>(mysheds))</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(lakes, <span class="fu">st_as_sf</span>(mysheds))</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> lakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gnis_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Leidy Lake"</span>))</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co"># points</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> snakeorder) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> snakeorder))</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co"># edit geometry to reduce overlap</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"SF Spread Creek Lower NWIS"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.32226</span>, <span class="fl">43.76118</span>))</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"NF Spread Creek Lower"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.3199</span>, <span class="fl">43.766533</span>))</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"Grizzly Creek"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.23289</span>, <span class="fl">43.77433</span>))</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"NF Spread Creek Upper"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.23405</span>, <span class="fl">43.77227</span>))</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(mylittleg)[mylittleg<span class="sc">$</span>site_name <span class="sc">==</span> <span class="st">"SF Spread Creek Upper"</span>] <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">110.31475</span>, <span class="fl">43.73661</span>))</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a><span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative variation</span></span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange),</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(totalyield_sum_z)</span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate annual median summer flow</span></span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>annmed <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span></span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, WaterYear) <span class="sc">%&gt;%</span></span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medlogYield =</span> <span class="fu">median</span>(logYield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange years by total annual yield</span></span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a>wtryrs_arranged <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))</span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a>plotlist_wb <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(wtryrs_arranged)) {</span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a>  mylittleg <span class="ot">&lt;-</span> siteinfo_sp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i]))</span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a>  mylittleg_sheds <span class="ot">&lt;-</span> sheds <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name <span class="sc">%in%</span> orderr) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(annmed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WaterYear <span class="sc">==</span> wtryrs_arranged[i])) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(area_sqmi))</span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a>  plotlist_wb[[i]] <span class="ot">&lt;-</span> <span class="fu">local</span>({</span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i</span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mysheds), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg_sheds, <span class="fu">aes</span>(<span class="at">fill =</span> medlogYield), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"G"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">range</span>(annmed<span class="sc">$</span>medlogYield), <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(mynet), <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> lakes, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"lightskyblue1"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> lakes, <span class="at">color =</span> <span class="st">"royalblue4"</span>, <span class="at">fill =</span> <span class="st">"lightskyblue1"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> mylittleg, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb59-89"><a href="#cb59-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median</span><span class="sc">\n</span><span class="st">summer</span><span class="sc">\n</span><span class="st">log(Yield)"</span>) <span class="sc">+</span> <span class="co">#annotation_scale() +</span></span>
<span id="cb59-90"><a href="#cb59-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">1</span>]), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">st_coordinates</span>(mylittleg_sheds)[,<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb59-92"><a href="#cb59-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.003</span>, <span class="fl">0.003</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.002</span>, <span class="fl">0.002</span>))</span>
<span id="cb59-93"><a href="#cb59-93" aria-hidden="true" tabindex="-1"></a>      <span class="co">#annotate("label", x = Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = 1.05, size = 5)</span></span>
<span id="cb59-94"><a href="#cb59-94" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb59-95"><a href="#cb59-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-96"><a href="#cb59-96" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plotlist_wb, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb59-97"><a href="#cb59-97" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="VarByClimate_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summermedianmap_Snake_annual.jpg", width = 4, height = 6, units = "in", res = 1000)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># p</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./SpaceTimeVar.html" class="pagination-link" aria-label="Spatiotemporal Variation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatiotemporal Variation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ReferenceLowFlow.html" class="pagination-link" aria-label="Low Flow Variation">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Low Flow Variation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb61" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Variation by Climate"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>**Purpose:** Quantify the effect of interannual variation in climatic conditions (water availability) on spatialy variability in headwater flow regimes. </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="in">library(mapview)</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpubr)</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="in">library(fasstr)</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="in">library(dygraphs)</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="in">library(htmlwidgets)</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="in">library(RColorBrewer)</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(GGally)</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(DT)</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="in">library(TSdist)</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggridges)</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggh4x)</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="in">library(viridis)</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(daymetr)</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(scico)</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="in">library(cetcolor)</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(plotly)</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(cowplot)</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(hydroEvents)</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(dtw)</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="in">library(nhdplusTools)</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="in">library(glue)</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="in">library(hydroGOF)</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="in">library(rptR)</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="in">library(moments)</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(fmsb)</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(terra)</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggspatial)</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(lme4)</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(MuMIn)</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="in">library(lmerTest)</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggfx)</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(riverdist)</span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>Site information</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>siteinfo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Data/EcoDrought_SiteInformation.csv"</span>)</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a>siteinfo_sp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(siteinfo, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a>Little g's (headwater sites)</span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a>dat_clean <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Qualitative/LittleG_data_clean.csv"</span>)</span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a>Big G's (reference gages)</span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a>dat_clean_big <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Qualitative/BigG_data_clean.csv"</span>)</span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a>Water availability. In western, snowmelt-dominated basins, annual (water year) total yield is strongly related to summer total yield. But in eastern, rain-dominated basins, the relationship is much weaker, suggesting "faster" response to climate forcing in rain-dominated basins. Use total summer yield (percentile) as metric of interannual variation in water availability.</span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a>wateravail <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Qualitative/BigG_wateravailability_annual.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(totalyield), <span class="sc">!</span><span class="fu">is.na</span>(totalyield_sum)) <span class="sc">%&gt;%</span></span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tyz_perc =</span> <span class="fu">percentile</span>(totalyield_z),</span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a>         <span class="at">tyz_sum_perc =</span> <span class="fu">percentile</span>(totalyield_sum_z)) <span class="sc">%&gt;%</span></span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tyz_perc =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tyz_perc), <span class="dv">0</span>, tyz_perc),</span>
<span id="cb61-84"><a href="#cb61-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">tyz_sum_perc =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tyz_sum_perc), <span class="dv">0</span>, tyz_sum_perc))</span>
<span id="cb61-85"><a href="#cb61-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a>wateravail <span class="sc">%&gt;%</span> </span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">!=</span> <span class="st">"Piney River"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Shields River"</span>, <span class="st">"Yellowstone River"</span>, basin)) <span class="sc">%&gt;%</span></span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">factor</span>(basin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Staunton River"</span>, <span class="st">"Paine Run"</span>, <span class="st">"Flathead"</span>, <span class="st">"Yellowstone River"</span>, <span class="st">"Snake River"</span>, <span class="st">"Donner Blitzen"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tyz_perc, <span class="at">y =</span> tyz_sum_perc)) <span class="sc">+</span> </span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Total annual yield (percentile)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Total summer yield (percentile)"</span>) <span class="sc">+</span> </span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>basin) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-97"><a href="#cb61-97" aria-hidden="true" tabindex="-1"></a>Order sites</span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a>wborder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"West Brook NWIS"</span>, <span class="st">"West Brook Lower"</span>, <span class="st">"Mitchell Brook"</span>, <span class="st">"Jimmy Brook"</span>, <span class="st">"Obear Brook Lower"</span>, <span class="st">"West Brook Upper"</span>, <span class="st">"West Brook Reservoir"</span>, <span class="st">"Sanderson Brook"</span>, <span class="st">"Avery Brook"</span>, <span class="st">"West Whately Brook"</span>)</span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a>paineorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Paine Run 10"</span>, <span class="st">"Paine Run 08"</span>, <span class="st">"Paine Run 07"</span>, <span class="st">"Paine Run 06"</span>, <span class="st">"Paine Run 02"</span>, <span class="st">"Paine Run 01"</span>)</span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a>stauntorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Staunton River 10"</span>, <span class="st">"Staunton River 09"</span>, <span class="st">"Staunton River 07"</span>, <span class="st">"Staunton River 06"</span>, <span class="st">"Staunton River 03"</span>, <span class="st">"Staunton River 02"</span>)</span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a>flatorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BigCreekLower"</span>, <span class="st">"LangfordCreekLower"</span>, <span class="st">"LangfordCreekUpper"</span>, <span class="st">"Big Creek NWIS"</span>, <span class="st">"BigCreekUpper"</span>, <span class="st">"HallowattCreekLower"</span>, <span class="st">"NicolaCreek"</span>, <span class="st">"WernerCreek"</span>, <span class="st">"Hallowat Creek NWIS"</span>, <span class="st">"CoalCreekLower"</span>, <span class="st">"CycloneCreekLower"</span>, <span class="st">"CycloneCreekMiddle"</span>, <span class="st">"CycloneCreekUpper"</span>, <span class="st">"CoalCreekMiddle"</span>, <span class="st">"CoalCreekNorth"</span>, <span class="st">"CoalCreekHeadwaters"</span>, <span class="st">"McGeeCreekLower"</span>, <span class="st">"McGeeCreekTrib"</span>, <span class="st">"McGeeCreekUpper"</span>)</span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a>yellorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Shields River Valley Ranch"</span>, <span class="st">"Deep Creek"</span>, <span class="st">"Crandall Creek"</span>, <span class="st">"Buck Creek"</span>, <span class="st">"Dugout Creek"</span>, <span class="st">"Shields River ab Dugout"</span>, <span class="st">"Lodgepole Creek"</span>, <span class="st">"EF Duck Creek be HF"</span>, <span class="st">"EF Duck Creek ab HF"</span>, <span class="st">"Henrys Fork"</span>)</span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a>snakeorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Spread Creek Dam"</span>, <span class="st">"Rock Creek"</span>, <span class="st">"NF Spread Creek Lower"</span>, <span class="st">"NF Spread Creek Upper"</span>, <span class="st">"Grizzly Creek"</span>, <span class="st">"SF Spread Creek Lower"</span>, <span class="st">"Grouse Creek"</span>, <span class="st">"SF Spread Creek Upper"</span>, <span class="st">"Leidy Creek Mouth"</span>)</span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a>donnerorder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fish Creek NWIS"</span>, <span class="st">"Donner Blitzen ab Fish NWIS"</span>, <span class="st">"Donner Blitzen nr Burnt Car NWIS"</span>, <span class="st">"Donner Blitzen ab Indian NWIS"</span>)</span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a>Get catchment shapefiles</span>
<span id="cb61-112"><a href="#cb61-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results='hide'}</span></span>
<span id="cb61-113"><a href="#cb61-113" aria-hidden="true" tabindex="-1"></a><span class="in">sheds_list &lt;- list()</span></span>
<span id="cb61-114"><a href="#cb61-114" aria-hidden="true" tabindex="-1"></a><span class="in">myfiles &lt;- list.files(path = "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/", pattern = ".shp")</span></span>
<span id="cb61-115"><a href="#cb61-115" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:length(myfiles)) {</span></span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a><span class="in">  sheds_list[[i]] &lt;- st_read(paste("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/", myfiles[i], sep = ""))</span></span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-118"><a href="#cb61-118" aria-hidden="true" tabindex="-1"></a><span class="in">sheds &lt;- do.call(rbind, sheds_list) %&gt;% </span></span>
<span id="cb61-119"><a href="#cb61-119" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_id = ifelse(site_id == "SP01", "SP07", ifelse(site_id == "SP07", "SP01", site_id))) %&gt;%</span></span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(siteinfo)</span></span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a><span class="in">#mapview(sheds %&gt;% arrange(desc(area_sqmi)), alpha.regions = 0.2)</span></span>
<span id="cb61-122"><a href="#cb61-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-123"><a href="#cb61-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-124"><a href="#cb61-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-125"><a href="#cb61-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## Median summer flow</span></span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a>Plot maps of median summer flow across years/networks</span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb61-130"><a href="#cb61-130" aria-hidden="true" tabindex="-1"></a><span class="fu">### West Brook</span></span>
<span id="cb61-131"><a href="#cb61-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width = 9, fig.height = 5}</span></span>
<span id="cb61-132"><a href="#cb61-132" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "West Brook"</span></span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- wborder</span></span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2020:2024)</span></span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a><span class="in"># sheds and network</span></span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Mass_Watersheds.shp")</span></span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "WBR",]</span></span>
<span id="cb61-139"><a href="#cb61-139" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Mass_Streams.shp")</span></span>
<span id="cb61-140"><a href="#cb61-140" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a><span class="in"># get lakes</span></span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- get_waterbodies(AOI = siteinfo_sp %&gt;% filter(site_name == "West Brook NWIS"), buffer = 10000)</span></span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- lakes %&gt;% filter(gnis_name %in% c("Northampton Reservoir Upper", "Northampton Reservoir"))</span></span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a><span class="in">#st_write(lakes, "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Study area maps/lakes/lakes_WestBrook.shp")</span></span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a><span class="in"># little g points</span></span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% wborder) %&gt;% mutate(site_name = factor(site_name, levels = wborder))</span></span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-152"><a href="#cb61-152" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-153"><a href="#cb61-153" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9))</span></span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate variability for reference gage</span></span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-165"><a href="#cb61-165" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-166"><a href="#cb61-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-173"><a href="#cb61-173" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-174"><a href="#cb61-174" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-175"><a href="#cb61-175" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-176"><a href="#cb61-176" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-177"><a href="#cb61-177" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-178"><a href="#cb61-178" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-179"><a href="#cb61-179" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-180"><a href="#cb61-180" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-181"><a href="#cb61-181" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-182"><a href="#cb61-182" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-183"><a href="#cb61-183" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-184"><a href="#cb61-184" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-185"><a href="#cb61-185" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-186"><a href="#cb61-186" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-187"><a href="#cb61-187" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-188"><a href="#cb61-188" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-189"><a href="#cb61-189" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-190"><a href="#cb61-190" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-191"><a href="#cb61-191" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-192"><a href="#cb61-192" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-193"><a href="#cb61-193" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-194"><a href="#cb61-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-195"><a href="#cb61-195" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate long-term median of summer median flow, to center color scheme</span></span>
<span id="cb61-196"><a href="#cb61-196" aria-hidden="true" tabindex="-1"></a><span class="in">annmed_big &lt;- tempdat_big %&gt;%</span></span>
<span id="cb61-197"><a href="#cb61-197" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-198"><a href="#cb61-198" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-199"><a href="#cb61-199" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-200"><a href="#cb61-200" aria-hidden="true" tabindex="-1"></a><span class="in">annmed_big &lt;- median(annmed_big$medlogYield)</span></span>
<span id="cb61-201"><a href="#cb61-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-202"><a href="#cb61-202" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-203"><a href="#cb61-203" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-204"><a href="#cb61-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-205"><a href="#cb61-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-206"><a href="#cb61-206" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-207"><a href="#cb61-207" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_wb &lt;- list()</span></span>
<span id="cb61-208"><a href="#cb61-208" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-209"><a href="#cb61-209" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-210"><a href="#cb61-210" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-211"><a href="#cb61-211" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_wb[[i]] &lt;- local({</span></span>
<span id="cb61-212"><a href="#cb61-212" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-213"><a href="#cb61-213" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-214"><a href="#cb61-214" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-215"><a href="#cb61-215" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-216"><a href="#cb61-216" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-217"><a href="#cb61-217" aria-hidden="true" tabindex="-1"></a><span class="in">      #scale_fill_gradientn(colours = rev(hcl.colors(100, "Zissou1")), limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-218"><a href="#cb61-218" aria-hidden="true" tabindex="-1"></a><span class="in">      #scale_fill_gradientn(colours = cet_pal(100, name = "l16"), limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-219"><a href="#cb61-219" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-220"><a href="#cb61-220" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-221"><a href="#cb61-221" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = lakes, color = "white", fill = "lightskyblue1", linewidth = 0.7) +</span></span>
<span id="cb61-222"><a href="#cb61-222" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = lakes, color = "royalblue4", fill = "lightskyblue1", linewidth = 0.5) +</span></span>
<span id="cb61-223"><a href="#cb61-223" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-224"><a href="#cb61-224" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-225"><a href="#cb61-225" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-226"><a href="#cb61-226" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-227"><a href="#cb61-227" aria-hidden="true" tabindex="-1"></a><span class="in">      annotate("label", x = Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = 1.05, size = 5)})</span></span>
<span id="cb61-228"><a href="#cb61-228" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-229"><a href="#cb61-229" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(plotlist = plotlist_wb, common.legend = TRUE, legend = "right")</span></span>
<span id="cb61-230"><a href="#cb61-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-231"><a href="#cb61-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-232"><a href="#cb61-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-233"><a href="#cb61-233" aria-hidden="true" tabindex="-1"></a><span class="fu">### Paine Run</span></span>
<span id="cb61-234"><a href="#cb61-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width = 6, fig.height = 5}</span></span>
<span id="cb61-235"><a href="#cb61-235" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Paine Run"</span></span>
<span id="cb61-236"><a href="#cb61-236" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- paineorder</span></span>
<span id="cb61-237"><a href="#cb61-237" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2019:2022)</span></span>
<span id="cb61-238"><a href="#cb61-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-239"><a href="#cb61-239" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Shen_Watersheds.shp")</span></span>
<span id="cb61-240"><a href="#cb61-240" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "PA_10FL",]</span></span>
<span id="cb61-241"><a href="#cb61-241" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Shen_Streams.shp")</span></span>
<span id="cb61-242"><a href="#cb61-242" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-243"><a href="#cb61-243" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-244"><a href="#cb61-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-245"><a href="#cb61-245" aria-hidden="true" tabindex="-1"></a><span class="in"># hillshade</span></span>
<span id="cb61-246"><a href="#cb61-246" aria-hidden="true" tabindex="-1"></a><span class="in">myrast &lt;- rast("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Data/Spatial data/Elevation/Shenandoah_DEM_10m_nc.tif")</span></span>
<span id="cb61-247"><a href="#cb61-247" aria-hidden="true" tabindex="-1"></a><span class="in">myrast &lt;- mask(crop(myrast, mysheds), mysheds)</span></span>
<span id="cb61-248"><a href="#cb61-248" aria-hidden="true" tabindex="-1"></a><span class="in">slo &lt;- terrain(myrast, "slope", unit = "radians") </span></span>
<span id="cb61-249"><a href="#cb61-249" aria-hidden="true" tabindex="-1"></a><span class="in">asp &lt;- terrain(myrast, "aspect", unit = "radians")</span></span>
<span id="cb61-250"><a href="#cb61-250" aria-hidden="true" tabindex="-1"></a><span class="in">hill &lt;- shade(slope = slo, aspect = asp, angle = 40, direction = 270)</span></span>
<span id="cb61-251"><a href="#cb61-251" aria-hidden="true" tabindex="-1"></a><span class="in">hilldf &lt;- as.data.frame(hill, xy = TRUE)</span></span>
<span id="cb61-252"><a href="#cb61-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-253"><a href="#cb61-253" aria-hidden="true" tabindex="-1"></a><span class="in"># little g points</span></span>
<span id="cb61-254"><a href="#cb61-254" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr)</span></span>
<span id="cb61-255"><a href="#cb61-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-256"><a href="#cb61-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-257"><a href="#cb61-257" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-258"><a href="#cb61-258" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-259"><a href="#cb61-259" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-260"><a href="#cb61-260" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-261"><a href="#cb61-261" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-262"><a href="#cb61-262" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-263"><a href="#cb61-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-264"><a href="#cb61-264" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-265"><a href="#cb61-265" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-266"><a href="#cb61-266" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-267"><a href="#cb61-267" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-268"><a href="#cb61-268" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-269"><a href="#cb61-269" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-270"><a href="#cb61-270" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-271"><a href="#cb61-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-272"><a href="#cb61-272" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-273"><a href="#cb61-273" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-274"><a href="#cb61-274" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-275"><a href="#cb61-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-276"><a href="#cb61-276" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-277"><a href="#cb61-277" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-278"><a href="#cb61-278" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-279"><a href="#cb61-279" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-280"><a href="#cb61-280" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-281"><a href="#cb61-281" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-282"><a href="#cb61-282" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-283"><a href="#cb61-283" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-284"><a href="#cb61-284" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-285"><a href="#cb61-285" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-286"><a href="#cb61-286" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-287"><a href="#cb61-287" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-288"><a href="#cb61-288" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-289"><a href="#cb61-289" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-290"><a href="#cb61-290" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-291"><a href="#cb61-291" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-292"><a href="#cb61-292" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-293"><a href="#cb61-293" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-294"><a href="#cb61-294" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-295"><a href="#cb61-295" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-296"><a href="#cb61-296" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-297"><a href="#cb61-297" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-298"><a href="#cb61-298" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-299"><a href="#cb61-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-300"><a href="#cb61-300" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-301"><a href="#cb61-301" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-302"><a href="#cb61-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-303"><a href="#cb61-303" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-304"><a href="#cb61-304" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_pa &lt;- list()</span></span>
<span id="cb61-305"><a href="#cb61-305" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-306"><a href="#cb61-306" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-307"><a href="#cb61-307" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-308"><a href="#cb61-308" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_pa[[i]] &lt;- local({</span></span>
<span id="cb61-309"><a href="#cb61-309" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-310"><a href="#cb61-310" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-311"><a href="#cb61-311" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-312"><a href="#cb61-312" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-313"><a href="#cb61-313" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-314"><a href="#cb61-314" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-315"><a href="#cb61-315" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-316"><a href="#cb61-316" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-317"><a href="#cb61-317" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-318"><a href="#cb61-318" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-319"><a href="#cb61-319" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-320"><a href="#cb61-320" aria-hidden="true" tabindex="-1"></a><span class="in">      annotate("label", x = -Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = -0.05, size = 5)})</span></span>
<span id="cb61-321"><a href="#cb61-321" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-322"><a href="#cb61-322" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(plotlist = plotlist_pa, common.legend = TRUE, legend = "right")</span></span>
<span id="cb61-323"><a href="#cb61-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-324"><a href="#cb61-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-325"><a href="#cb61-325" aria-hidden="true" tabindex="-1"></a><span class="fu">### Staunton River</span></span>
<span id="cb61-326"><a href="#cb61-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width = 6, fig.height = 5}</span></span>
<span id="cb61-327"><a href="#cb61-327" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Staunton River"</span></span>
<span id="cb61-328"><a href="#cb61-328" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- stauntorder</span></span>
<span id="cb61-329"><a href="#cb61-329" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2019:2022)</span></span>
<span id="cb61-330"><a href="#cb61-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-331"><a href="#cb61-331" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Shen_Watersheds.shp")</span></span>
<span id="cb61-332"><a href="#cb61-332" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "SR_10FL",]</span></span>
<span id="cb61-333"><a href="#cb61-333" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Shen_Streams.shp")</span></span>
<span id="cb61-334"><a href="#cb61-334" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-335"><a href="#cb61-335" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-336"><a href="#cb61-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-337"><a href="#cb61-337" aria-hidden="true" tabindex="-1"></a><span class="in"># little g points</span></span>
<span id="cb61-338"><a href="#cb61-338" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr)</span></span>
<span id="cb61-339"><a href="#cb61-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-340"><a href="#cb61-340" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-341"><a href="#cb61-341" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-342"><a href="#cb61-342" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-343"><a href="#cb61-343" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-344"><a href="#cb61-344" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-345"><a href="#cb61-345" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-346"><a href="#cb61-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-347"><a href="#cb61-347" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-348"><a href="#cb61-348" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-349"><a href="#cb61-349" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-350"><a href="#cb61-350" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-351"><a href="#cb61-351" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-352"><a href="#cb61-352" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-353"><a href="#cb61-353" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-354"><a href="#cb61-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-355"><a href="#cb61-355" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-356"><a href="#cb61-356" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-357"><a href="#cb61-357" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-358"><a href="#cb61-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-359"><a href="#cb61-359" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-360"><a href="#cb61-360" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-361"><a href="#cb61-361" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-362"><a href="#cb61-362" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-363"><a href="#cb61-363" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-364"><a href="#cb61-364" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-365"><a href="#cb61-365" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-366"><a href="#cb61-366" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-367"><a href="#cb61-367" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-368"><a href="#cb61-368" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-369"><a href="#cb61-369" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-370"><a href="#cb61-370" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-371"><a href="#cb61-371" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-372"><a href="#cb61-372" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-373"><a href="#cb61-373" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-374"><a href="#cb61-374" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-375"><a href="#cb61-375" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-376"><a href="#cb61-376" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-377"><a href="#cb61-377" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-378"><a href="#cb61-378" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-379"><a href="#cb61-379" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-380"><a href="#cb61-380" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-381"><a href="#cb61-381" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-382"><a href="#cb61-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-383"><a href="#cb61-383" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-384"><a href="#cb61-384" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-385"><a href="#cb61-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-386"><a href="#cb61-386" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-387"><a href="#cb61-387" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_st &lt;- list()</span></span>
<span id="cb61-388"><a href="#cb61-388" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-389"><a href="#cb61-389" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-390"><a href="#cb61-390" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-391"><a href="#cb61-391" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_st[[i]] &lt;- local({</span></span>
<span id="cb61-392"><a href="#cb61-392" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-393"><a href="#cb61-393" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-394"><a href="#cb61-394" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-395"><a href="#cb61-395" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-396"><a href="#cb61-396" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-397"><a href="#cb61-397" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-398"><a href="#cb61-398" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-399"><a href="#cb61-399" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-400"><a href="#cb61-400" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-401"><a href="#cb61-401" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-402"><a href="#cb61-402" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-403"><a href="#cb61-403" aria-hidden="true" tabindex="-1"></a><span class="in">      annotate("label", x = Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = 1.05, size = 5)})</span></span>
<span id="cb61-404"><a href="#cb61-404" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-405"><a href="#cb61-405" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(plotlist = plotlist_st, common.legend = TRUE, legend = "right")</span></span>
<span id="cb61-406"><a href="#cb61-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-407"><a href="#cb61-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-408"><a href="#cb61-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-409"><a href="#cb61-409" aria-hidden="true" tabindex="-1"></a><span class="fu">### Flathead</span></span>
<span id="cb61-410"><a href="#cb61-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height = 5, fig.width = 11}</span></span>
<span id="cb61-411"><a href="#cb61-411" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Flathead"</span></span>
<span id="cb61-412"><a href="#cb61-412" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- flatorder</span></span>
<span id="cb61-413"><a href="#cb61-413" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2018:2024)</span></span>
<span id="cb61-414"><a href="#cb61-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-415"><a href="#cb61-415" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Flat_Watersheds.shp")</span></span>
<span id="cb61-416"><a href="#cb61-416" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "NFF",]</span></span>
<span id="cb61-417"><a href="#cb61-417" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Flat_Streams.shp")</span></span>
<span id="cb61-418"><a href="#cb61-418" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-419"><a href="#cb61-419" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-420"><a href="#cb61-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-421"><a href="#cb61-421" aria-hidden="true" tabindex="-1"></a><span class="in"># get lakes</span></span>
<span id="cb61-422"><a href="#cb61-422" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- get_waterbodies(AOI = siteinfo_sp %&gt;% filter(site_name == "North Fork Flathead River NWIS"), buffer = 100000)</span></span>
<span id="cb61-423"><a href="#cb61-423" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- st_transform(lakes, crs(mysheds))</span></span>
<span id="cb61-424"><a href="#cb61-424" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- st_intersection(lakes, st_as_sf(mysheds))</span></span>
<span id="cb61-425"><a href="#cb61-425" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- lakes %&gt;% filter(gnis_name %in% c("Moose Lake", "Mud Lake"))</span></span>
<span id="cb61-426"><a href="#cb61-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-427"><a href="#cb61-427" aria-hidden="true" tabindex="-1"></a><span class="in"># points</span></span>
<span id="cb61-428"><a href="#cb61-428" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% flatorder) %&gt;% mutate(site_name = factor(site_name, levels = flatorder))</span></span>
<span id="cb61-429"><a href="#cb61-429" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "BigCreekUpper"] &lt;- st_point(c(-114.31506, 48.57672))</span></span>
<span id="cb61-430"><a href="#cb61-430" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "HallowattCreekLower"] &lt;- st_point(c(-114.31914, 48.57256))</span></span>
<span id="cb61-431"><a href="#cb61-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-432"><a href="#cb61-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-433"><a href="#cb61-433" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-434"><a href="#cb61-434" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-435"><a href="#cb61-435" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-436"><a href="#cb61-436" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-437"><a href="#cb61-437" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-438"><a href="#cb61-438" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-439"><a href="#cb61-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-440"><a href="#cb61-440" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-441"><a href="#cb61-441" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-442"><a href="#cb61-442" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-443"><a href="#cb61-443" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-444"><a href="#cb61-444" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-445"><a href="#cb61-445" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-446"><a href="#cb61-446" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-447"><a href="#cb61-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-448"><a href="#cb61-448" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-449"><a href="#cb61-449" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-450"><a href="#cb61-450" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-451"><a href="#cb61-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-452"><a href="#cb61-452" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-453"><a href="#cb61-453" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-454"><a href="#cb61-454" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-455"><a href="#cb61-455" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-456"><a href="#cb61-456" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-457"><a href="#cb61-457" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-458"><a href="#cb61-458" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-459"><a href="#cb61-459" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-460"><a href="#cb61-460" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-461"><a href="#cb61-461" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-462"><a href="#cb61-462" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-463"><a href="#cb61-463" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-464"><a href="#cb61-464" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-465"><a href="#cb61-465" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-466"><a href="#cb61-466" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-467"><a href="#cb61-467" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-468"><a href="#cb61-468" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-469"><a href="#cb61-469" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-470"><a href="#cb61-470" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-471"><a href="#cb61-471" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-472"><a href="#cb61-472" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-473"><a href="#cb61-473" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-474"><a href="#cb61-474" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-475"><a href="#cb61-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-476"><a href="#cb61-476" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-477"><a href="#cb61-477" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-478"><a href="#cb61-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-479"><a href="#cb61-479" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-480"><a href="#cb61-480" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_fl &lt;- list()</span></span>
<span id="cb61-481"><a href="#cb61-481" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-482"><a href="#cb61-482" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-483"><a href="#cb61-483" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-484"><a href="#cb61-484" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_fl[[i]] &lt;- local({</span></span>
<span id="cb61-485"><a href="#cb61-485" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-486"><a href="#cb61-486" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-487"><a href="#cb61-487" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-488"><a href="#cb61-488" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-489"><a href="#cb61-489" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-490"><a href="#cb61-490" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-491"><a href="#cb61-491" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-492"><a href="#cb61-492" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-493"><a href="#cb61-493" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-494"><a href="#cb61-494" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-495"><a href="#cb61-495" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-496"><a href="#cb61-496" aria-hidden="true" tabindex="-1"></a><span class="in">      annotate("label", x = Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = 1.05, size = 5)})</span></span>
<span id="cb61-497"><a href="#cb61-497" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-498"><a href="#cb61-498" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(plotlist = plotlist_fl, common.legend = TRUE, legend = "right")</span></span>
<span id="cb61-499"><a href="#cb61-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-500"><a href="#cb61-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-501"><a href="#cb61-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-502"><a href="#cb61-502" aria-hidden="true" tabindex="-1"></a><span class="fu">### Yellowstone</span></span>
<span id="cb61-503"><a href="#cb61-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height = 7, fig.width = 10}</span></span>
<span id="cb61-504"><a href="#cb61-504" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Shields River"</span></span>
<span id="cb61-505"><a href="#cb61-505" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- yellorder</span></span>
<span id="cb61-506"><a href="#cb61-506" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2016:2020,2022:2024)</span></span>
<span id="cb61-507"><a href="#cb61-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-508"><a href="#cb61-508" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Shields_Watersheds.shp")</span></span>
<span id="cb61-509"><a href="#cb61-509" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id %in% c("SRS", "DU01"),]</span></span>
<span id="cb61-510"><a href="#cb61-510" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Shields_Streams.shp")</span></span>
<span id="cb61-511"><a href="#cb61-511" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-512"><a href="#cb61-512" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-513"><a href="#cb61-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-514"><a href="#cb61-514" aria-hidden="true" tabindex="-1"></a><span class="in"># points</span></span>
<span id="cb61-515"><a href="#cb61-515" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% mutate(site_name = factor(site_name, levels = orderr)) #%&gt;% filter(subbasin != "Duck Creek")</span></span>
<span id="cb61-516"><a href="#cb61-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-517"><a href="#cb61-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-518"><a href="#cb61-518" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-519"><a href="#cb61-519" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-520"><a href="#cb61-520" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-521"><a href="#cb61-521" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-522"><a href="#cb61-522" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-523"><a href="#cb61-523" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-524"><a href="#cb61-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-525"><a href="#cb61-525" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-526"><a href="#cb61-526" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-527"><a href="#cb61-527" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-528"><a href="#cb61-528" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-529"><a href="#cb61-529" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-530"><a href="#cb61-530" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-531"><a href="#cb61-531" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-532"><a href="#cb61-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-533"><a href="#cb61-533" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-534"><a href="#cb61-534" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-535"><a href="#cb61-535" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-536"><a href="#cb61-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-537"><a href="#cb61-537" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-538"><a href="#cb61-538" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-539"><a href="#cb61-539" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-540"><a href="#cb61-540" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-541"><a href="#cb61-541" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-542"><a href="#cb61-542" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-543"><a href="#cb61-543" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-544"><a href="#cb61-544" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-545"><a href="#cb61-545" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-546"><a href="#cb61-546" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-547"><a href="#cb61-547" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-548"><a href="#cb61-548" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-549"><a href="#cb61-549" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-550"><a href="#cb61-550" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-551"><a href="#cb61-551" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-552"><a href="#cb61-552" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-553"><a href="#cb61-553" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-554"><a href="#cb61-554" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-555"><a href="#cb61-555" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-556"><a href="#cb61-556" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-557"><a href="#cb61-557" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-558"><a href="#cb61-558" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-559"><a href="#cb61-559" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-560"><a href="#cb61-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-561"><a href="#cb61-561" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-562"><a href="#cb61-562" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-563"><a href="#cb61-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-564"><a href="#cb61-564" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-565"><a href="#cb61-565" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_ye &lt;- list()</span></span>
<span id="cb61-566"><a href="#cb61-566" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-567"><a href="#cb61-567" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-568"><a href="#cb61-568" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-569"><a href="#cb61-569" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_ye[[i]] &lt;- local({</span></span>
<span id="cb61-570"><a href="#cb61-570" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-571"><a href="#cb61-571" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-572"><a href="#cb61-572" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-573"><a href="#cb61-573" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-574"><a href="#cb61-574" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-575"><a href="#cb61-575" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-576"><a href="#cb61-576" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-577"><a href="#cb61-577" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-578"><a href="#cb61-578" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-579"><a href="#cb61-579" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-580"><a href="#cb61-580" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-581"><a href="#cb61-581" aria-hidden="true" tabindex="-1"></a><span class="in">      annotate("label", x = -Inf, y = -Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = -0.15, hjust = -0.05, size = 5)})</span></span>
<span id="cb61-582"><a href="#cb61-582" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-583"><a href="#cb61-583" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(plotlist = plotlist_ye, common.legend = TRUE, legend = "right", nrow = 2, ncol = 4)</span></span>
<span id="cb61-584"><a href="#cb61-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-585"><a href="#cb61-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-586"><a href="#cb61-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-587"><a href="#cb61-587" aria-hidden="true" tabindex="-1"></a><span class="fu">### Snake</span></span>
<span id="cb61-588"><a href="#cb61-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height = 7, fig.width = 10}</span></span>
<span id="cb61-589"><a href="#cb61-589" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Snake River"</span></span>
<span id="cb61-590"><a href="#cb61-590" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- snakeorder</span></span>
<span id="cb61-591"><a href="#cb61-591" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2016:2024)</span></span>
<span id="cb61-592"><a href="#cb61-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-593"><a href="#cb61-593" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Snake_Watersheds.shp")</span></span>
<span id="cb61-594"><a href="#cb61-594" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "SP11",]</span></span>
<span id="cb61-595"><a href="#cb61-595" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Snake_Streams.shp")</span></span>
<span id="cb61-596"><a href="#cb61-596" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-597"><a href="#cb61-597" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-598"><a href="#cb61-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-599"><a href="#cb61-599" aria-hidden="true" tabindex="-1"></a><span class="in"># get lakes</span></span>
<span id="cb61-600"><a href="#cb61-600" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- get_waterbodies(AOI = siteinfo_sp %&gt;% filter(site_name == "Spread Creek Dam"), buffer = 100000)</span></span>
<span id="cb61-601"><a href="#cb61-601" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- st_transform(lakes, crs(mysheds))</span></span>
<span id="cb61-602"><a href="#cb61-602" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- st_intersection(lakes, st_as_sf(mysheds))</span></span>
<span id="cb61-603"><a href="#cb61-603" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- lakes %&gt;% filter(gnis_name %in% c("Leidy Lake"))</span></span>
<span id="cb61-604"><a href="#cb61-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-605"><a href="#cb61-605" aria-hidden="true" tabindex="-1"></a><span class="in"># points</span></span>
<span id="cb61-606"><a href="#cb61-606" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% snakeorder) %&gt;% mutate(site_name = factor(site_name, levels = snakeorder))</span></span>
<span id="cb61-607"><a href="#cb61-607" aria-hidden="true" tabindex="-1"></a><span class="in"># edit geometry to reduce overlap</span></span>
<span id="cb61-608"><a href="#cb61-608" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "SF Spread Creek Lower NWIS"] &lt;- st_point(c(-110.32226, 43.76118))</span></span>
<span id="cb61-609"><a href="#cb61-609" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "NF Spread Creek Lower"] &lt;- st_point(c(-110.3199, 43.766533))</span></span>
<span id="cb61-610"><a href="#cb61-610" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "Grizzly Creek"] &lt;- st_point(c(-110.23289, 43.77433))</span></span>
<span id="cb61-611"><a href="#cb61-611" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "NF Spread Creek Upper"] &lt;- st_point(c(-110.23405, 43.77227))</span></span>
<span id="cb61-612"><a href="#cb61-612" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "SF Spread Creek Upper"] &lt;- st_point(c(-110.31475, 43.73661))</span></span>
<span id="cb61-613"><a href="#cb61-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-614"><a href="#cb61-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-615"><a href="#cb61-615" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-616"><a href="#cb61-616" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-617"><a href="#cb61-617" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-618"><a href="#cb61-618" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-619"><a href="#cb61-619" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-620"><a href="#cb61-620" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-621"><a href="#cb61-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-622"><a href="#cb61-622" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-623"><a href="#cb61-623" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-624"><a href="#cb61-624" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-625"><a href="#cb61-625" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-626"><a href="#cb61-626" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-627"><a href="#cb61-627" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-628"><a href="#cb61-628" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-629"><a href="#cb61-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-630"><a href="#cb61-630" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-631"><a href="#cb61-631" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-632"><a href="#cb61-632" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-633"><a href="#cb61-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-634"><a href="#cb61-634" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-635"><a href="#cb61-635" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-636"><a href="#cb61-636" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-637"><a href="#cb61-637" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-638"><a href="#cb61-638" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-639"><a href="#cb61-639" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-640"><a href="#cb61-640" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-641"><a href="#cb61-641" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-642"><a href="#cb61-642" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-643"><a href="#cb61-643" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-644"><a href="#cb61-644" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-645"><a href="#cb61-645" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-646"><a href="#cb61-646" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-647"><a href="#cb61-647" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-648"><a href="#cb61-648" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-649"><a href="#cb61-649" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-650"><a href="#cb61-650" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-651"><a href="#cb61-651" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-652"><a href="#cb61-652" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-653"><a href="#cb61-653" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-654"><a href="#cb61-654" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-655"><a href="#cb61-655" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-656"><a href="#cb61-656" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-657"><a href="#cb61-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-658"><a href="#cb61-658" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-659"><a href="#cb61-659" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-660"><a href="#cb61-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-661"><a href="#cb61-661" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-662"><a href="#cb61-662" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_sn &lt;- list()</span></span>
<span id="cb61-663"><a href="#cb61-663" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-664"><a href="#cb61-664" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-665"><a href="#cb61-665" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-666"><a href="#cb61-666" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_sn[[i]] &lt;- local({</span></span>
<span id="cb61-667"><a href="#cb61-667" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-668"><a href="#cb61-668" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-669"><a href="#cb61-669" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-670"><a href="#cb61-670" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-671"><a href="#cb61-671" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-672"><a href="#cb61-672" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-673"><a href="#cb61-673" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-674"><a href="#cb61-674" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-675"><a href="#cb61-675" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-676"><a href="#cb61-676" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-677"><a href="#cb61-677" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-678"><a href="#cb61-678" aria-hidden="true" tabindex="-1"></a><span class="in">      annotate("label", x = -Inf, y = -Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = -0.15, hjust = -0.05, size = 5)})</span></span>
<span id="cb61-679"><a href="#cb61-679" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-680"><a href="#cb61-680" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(plotlist = plotlist_sn, common.legend = TRUE, legend = "right")</span></span>
<span id="cb61-681"><a href="#cb61-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-682"><a href="#cb61-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-683"><a href="#cb61-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-684"><a href="#cb61-684" aria-hidden="true" tabindex="-1"></a><span class="fu">### Donner Blitzen</span></span>
<span id="cb61-685"><a href="#cb61-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height = 5.5, fig.width = 5.5}</span></span>
<span id="cb61-686"><a href="#cb61-686" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Donner Blitzen"</span></span>
<span id="cb61-687"><a href="#cb61-687" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- c(donnerorder, "Donner Blitzen River nr Frenchglen NWIS")</span></span>
<span id="cb61-688"><a href="#cb61-688" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2016:2024)</span></span>
<span id="cb61-689"><a href="#cb61-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-690"><a href="#cb61-690" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Oreg_Watersheds.shp")</span></span>
<span id="cb61-691"><a href="#cb61-691" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "DBF",]</span></span>
<span id="cb61-692"><a href="#cb61-692" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Oreg_Streams.shp")</span></span>
<span id="cb61-693"><a href="#cb61-693" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-694"><a href="#cb61-694" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-695"><a href="#cb61-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-696"><a href="#cb61-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-697"><a href="#cb61-697" aria-hidden="true" tabindex="-1"></a><span class="in"># points</span></span>
<span id="cb61-698"><a href="#cb61-698" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% mutate(site_name = factor(site_name, levels = donnerorder))</span></span>
<span id="cb61-699"><a href="#cb61-699" aria-hidden="true" tabindex="-1"></a><span class="in"># edit geometry to reduce overlap</span></span>
<span id="cb61-700"><a href="#cb61-700" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "Donner Blitzen ab Fish NWIS"] &lt;- st_point(c(-118.84315, 42.75476))</span></span>
<span id="cb61-701"><a href="#cb61-701" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "Fish Creek"] &lt;- st_point(c(-118.83173, 42.75911))</span></span>
<span id="cb61-702"><a href="#cb61-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-703"><a href="#cb61-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-704"><a href="#cb61-704" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-705"><a href="#cb61-705" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-706"><a href="#cb61-706" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-707"><a href="#cb61-707" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-708"><a href="#cb61-708" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-709"><a href="#cb61-709" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-710"><a href="#cb61-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-711"><a href="#cb61-711" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-712"><a href="#cb61-712" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-713"><a href="#cb61-713" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-714"><a href="#cb61-714" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-715"><a href="#cb61-715" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-716"><a href="#cb61-716" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-717"><a href="#cb61-717" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-718"><a href="#cb61-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-719"><a href="#cb61-719" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-720"><a href="#cb61-720" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-721"><a href="#cb61-721" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-722"><a href="#cb61-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-723"><a href="#cb61-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-724"><a href="#cb61-724" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-725"><a href="#cb61-725" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-726"><a href="#cb61-726" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-727"><a href="#cb61-727" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-728"><a href="#cb61-728" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-729"><a href="#cb61-729" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-730"><a href="#cb61-730" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-731"><a href="#cb61-731" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-732"><a href="#cb61-732" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-733"><a href="#cb61-733" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-734"><a href="#cb61-734" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-735"><a href="#cb61-735" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-736"><a href="#cb61-736" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-737"><a href="#cb61-737" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-738"><a href="#cb61-738" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-739"><a href="#cb61-739" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-740"><a href="#cb61-740" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-741"><a href="#cb61-741" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-742"><a href="#cb61-742" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-743"><a href="#cb61-743" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-744"><a href="#cb61-744" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-745"><a href="#cb61-745" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb61-746"><a href="#cb61-746" aria-hidden="true" tabindex="-1"></a><span class="in">  bind_rows(tempdat_big %&gt;%</span></span>
<span id="cb61-747"><a href="#cb61-747" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-748"><a href="#cb61-748" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-749"><a href="#cb61-749" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup())</span></span>
<span id="cb61-750"><a href="#cb61-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-751"><a href="#cb61-751" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-752"><a href="#cb61-752" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-753"><a href="#cb61-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-754"><a href="#cb61-754" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-755"><a href="#cb61-755" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_db &lt;- list()</span></span>
<span id="cb61-756"><a href="#cb61-756" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-757"><a href="#cb61-757" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-758"><a href="#cb61-758" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-759"><a href="#cb61-759" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_db[[i]] &lt;- local({</span></span>
<span id="cb61-760"><a href="#cb61-760" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-761"><a href="#cb61-761" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-762"><a href="#cb61-762" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-763"><a href="#cb61-763" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-764"><a href="#cb61-764" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-765"><a href="#cb61-765" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-766"><a href="#cb61-766" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-767"><a href="#cb61-767" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-768"><a href="#cb61-768" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-769"><a href="#cb61-769" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-770"><a href="#cb61-770" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-771"><a href="#cb61-771" aria-hidden="true" tabindex="-1"></a><span class="in">      annotate("label", x = -Inf, y = -Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = -0.15, hjust = -0.05, size = 5)})</span></span>
<span id="cb61-772"><a href="#cb61-772" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-773"><a href="#cb61-773" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(plotlist = plotlist_db, common.legend = TRUE, legend = "right")</span></span>
<span id="cb61-774"><a href="#cb61-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-775"><a href="#cb61-775" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-776"><a href="#cb61-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-777"><a href="#cb61-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-778"><a href="#cb61-778" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distribution and variability</span></span>
<span id="cb61-779"><a href="#cb61-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-780"><a href="#cb61-780" aria-hidden="true" tabindex="-1"></a>Create function to plot interannual distribution of streamflow values, annual distributions of streamflow values, and scatterplot plot of spatial streamflow heterogeneity by water availability</span>
<span id="cb61-783"><a href="#cb61-783" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-784"><a href="#cb61-784" aria-hidden="true" tabindex="-1"></a>portfolioplot <span class="ot">&lt;-</span> <span class="cf">function</span>(bas, orderr, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"interann"</span>, <span class="st">"annual"</span>, <span class="st">"scatter"</span>), wtryrs) {</span>
<span id="cb61-785"><a href="#cb61-785" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter data</span></span>
<span id="cb61-786"><a href="#cb61-786" aria-hidden="true" tabindex="-1"></a>  tempdat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb61-787"><a href="#cb61-787" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb61-788"><a href="#cb61-788" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> orderr))</span>
<span id="cb61-789"><a href="#cb61-789" aria-hidden="true" tabindex="-1"></a>  nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempdat<span class="sc">$</span>site_name))</span>
<span id="cb61-790"><a href="#cb61-790" aria-hidden="true" tabindex="-1"></a>  tempdat_big <span class="ot">&lt;-</span> dat_clean_big <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> bas, <span class="sc">!</span><span class="fu">is.na</span>(logYield), Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), WaterYear <span class="sc">%in%</span> <span class="fu">unique</span>(tempdat<span class="sc">$</span>WaterYear))</span>
<span id="cb61-791"><a href="#cb61-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-792"><a href="#cb61-792" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variability for reference gage</span></span>
<span id="cb61-793"><a href="#cb61-793" aria-hidden="true" tabindex="-1"></a>  varbig <span class="ot">&lt;-</span> tempdat_big <span class="sc">%&gt;%</span> </span>
<span id="cb61-794"><a href="#cb61-794" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb61-795"><a href="#cb61-795" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb61-796"><a href="#cb61-796" aria-hidden="true" tabindex="-1"></a>              <span class="at">bigsd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb61-797"><a href="#cb61-797" aria-hidden="true" tabindex="-1"></a>              <span class="at">bigvar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span></span>
<span id="cb61-798"><a href="#cb61-798" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb61-799"><a href="#cb61-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-800"><a href="#cb61-800" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-801"><a href="#cb61-801" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-802"><a href="#cb61-802" aria-hidden="true" tabindex="-1"></a>  <span class="co">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-803"><a href="#cb61-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-804"><a href="#cb61-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-805"><a href="#cb61-805" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate relative variation</span></span>
<span id="cb61-806"><a href="#cb61-806" aria-hidden="true" tabindex="-1"></a>  pedat <span class="ot">&lt;-</span> tempdat <span class="sc">%&gt;%</span> </span>
<span id="cb61-807"><a href="#cb61-807" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb61-808"><a href="#cb61-808" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb61-809"><a href="#cb61-809" aria-hidden="true" tabindex="-1"></a>              <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>],</span>
<span id="cb61-810"><a href="#cb61-810" aria-hidden="true" tabindex="-1"></a>              <span class="at">littlesd =</span> <span class="fu">sd</span>(logYield),</span>
<span id="cb61-811"><a href="#cb61-811" aria-hidden="true" tabindex="-1"></a>              <span class="at">littlevar =</span> <span class="fu">var</span>(logYield)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-812"><a href="#cb61-812" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-813"><a href="#cb61-813" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(varbig) <span class="sc">%&gt;%</span></span>
<span id="cb61-814"><a href="#cb61-814" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb61-815"><a href="#cb61-815" aria-hidden="true" tabindex="-1"></a>           <span class="at">pe_sd =</span> ((littlesd<span class="sc">-</span>bigsd)<span class="sc">/</span>bigsd),</span>
<span id="cb61-816"><a href="#cb61-816" aria-hidden="true" tabindex="-1"></a>           <span class="at">pe_var =</span> ((littlevar<span class="sc">-</span>bigvar)<span class="sc">/</span>bigvar)) <span class="sc">%&gt;%</span></span>
<span id="cb61-817"><a href="#cb61-817" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_sum_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-818"><a href="#cb61-818" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(WaterYear <span class="sc">%in%</span> wtryrs) <span class="sc">%&gt;%</span></span>
<span id="cb61-819"><a href="#cb61-819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wylab =</span> <span class="fu">substr</span>(WaterYear, <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb61-820"><a href="#cb61-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-821"><a href="#cb61-821" aria-hidden="true" tabindex="-1"></a>  <span class="co"># interannual</span></span>
<span id="cb61-822"><a href="#cb61-822" aria-hidden="true" tabindex="-1"></a>  pint <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb61-823"><a href="#cb61-823" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled.., <span class="at">color =</span> site_name, <span class="at">fill =</span> site_name), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb61-824"><a href="#cb61-824" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>)) <span class="sc">+</span></span>
<span id="cb61-825"><a href="#cb61-825" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>), <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb61-826"><a href="#cb61-826" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat_big, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled..), <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"grey40"</span>, <span class="fl">0.2</span>), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb61-827"><a href="#cb61-827" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Summer log(Yield, mm/day)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Scaled density"</span>) <span class="sc">+</span></span>
<span id="cb61-828"><a href="#cb61-828" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb61-829"><a href="#cb61-829" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb61-830"><a href="#cb61-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-831"><a href="#cb61-831" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annual</span></span>
<span id="cb61-832"><a href="#cb61-832" aria-hidden="true" tabindex="-1"></a>  pann <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb61-833"><a href="#cb61-833" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled.., <span class="at">color =</span> site_name, <span class="at">fill =</span> site_name), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb61-834"><a href="#cb61-834" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>)) <span class="sc">+</span></span>
<span id="cb61-835"><a href="#cb61-835" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">cet_pal</span>(nsites, <span class="at">name =</span> <span class="st">"i1"</span>), <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb61-836"><a href="#cb61-836" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">data =</span> tempdat_big, <span class="fu">aes</span>(<span class="at">x =</span> logYield, <span class="at">y =</span> ..scaled..), <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"grey40"</span>, <span class="fl">0.2</span>), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb61-837"><a href="#cb61-837" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Summer log(Yield, mm/day)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Scaled density"</span>) <span class="sc">+</span></span>
<span id="cb61-838"><a href="#cb61-838" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb61-839"><a href="#cb61-839" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb61-840"><a href="#cb61-840" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">factor</span>(WaterYear, <span class="at">levels =</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(pedat <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(totalyield_sum_z) <span class="sc">%&gt;%</span> <span class="fu">select</span>(WaterYear)))))</span>
<span id="cb61-841"><a href="#cb61-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-842"><a href="#cb61-842" aria-hidden="true" tabindex="-1"></a>  <span class="co"># portfolio effect by water availability</span></span>
<span id="cb61-843"><a href="#cb61-843" aria-hidden="true" tabindex="-1"></a>  ppew <span class="ot">&lt;-</span> pedat <span class="sc">%&gt;%</span> </span>
<span id="cb61-844"><a href="#cb61-844" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_range, <span class="at">label =</span> wylab)) <span class="sc">+</span> </span>
<span id="cb61-845"><a href="#cb61-845" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">0</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-846"><a href="#cb61-846" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb61-847"><a href="#cb61-847" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"skyblue1"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb61-848"><a href="#cb61-848" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb61-849"><a href="#cb61-849" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Water availability"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Relative difference in range"</span>) <span class="sc">+</span></span>
<span id="cb61-850"><a href="#cb61-850" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span>     </span>
<span id="cb61-851"><a href="#cb61-851" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Water year"</span>)) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">100</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">450</span>)</span>
<span id="cb61-852"><a href="#cb61-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-853"><a href="#cb61-853" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"interannual"</span>) { <span class="fu">return</span>(pint) }</span>
<span id="cb61-854"><a href="#cb61-854" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"annual"</span>) { <span class="fu">return</span>(pann) }</span>
<span id="cb61-855"><a href="#cb61-855" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"scatter"</span>) { <span class="fu">return</span>(ppew) }</span>
<span id="cb61-856"><a href="#cb61-856" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"table"</span>) { <span class="fu">return</span>(pedat) }</span>
<span id="cb61-857"><a href="#cb61-857" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-858"><a href="#cb61-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-859"><a href="#cb61-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-860"><a href="#cb61-860" aria-hidden="true" tabindex="-1"></a>Generate plots</span>
<span id="cb61-861"><a href="#cb61-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb61-862"><a href="#cb61-862" aria-hidden="true" tabindex="-1"></a><span class="in"># West Brook</span></span>
<span id="cb61-863"><a href="#cb61-863" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- egg::ggarrange(portfolioplot(bas = "West Brook", orderr = wborder, type = "interannual", wtryrs = c(2020:2024)),</span></span>
<span id="cb61-864"><a href="#cb61-864" aria-hidden="true" tabindex="-1"></a><span class="in">               portfolioplot(bas = "West Brook", orderr = wborder, type = "scatter", wtryrs = c(2020:2024)),</span></span>
<span id="cb61-865"><a href="#cb61-865" aria-hidden="true" tabindex="-1"></a><span class="in">               nrow = 2)</span></span>
<span id="cb61-866"><a href="#cb61-866" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- portfolioplot(bas = "West Brook", orderr = wborder, type = "annual", wtryrs = c(2020:2024))</span></span>
<span id="cb61-867"><a href="#cb61-867" aria-hidden="true" tabindex="-1"></a><span class="in">denwb &lt;- ggarrange(p1, p2, ncol = 2, widths = c(0.7,1))</span></span>
<span id="cb61-868"><a href="#cb61-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-869"><a href="#cb61-869" aria-hidden="true" tabindex="-1"></a><span class="in"># Paine</span></span>
<span id="cb61-870"><a href="#cb61-870" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- egg::ggarrange(portfolioplot(bas = "Paine Run", orderr = paineorder, type = "interannual", wtryrs = c(2019:2022)),</span></span>
<span id="cb61-871"><a href="#cb61-871" aria-hidden="true" tabindex="-1"></a><span class="in">               portfolioplot(bas = "Paine Run", orderr = paineorder, type = "scatter", wtryrs = c(2019:2022)),</span></span>
<span id="cb61-872"><a href="#cb61-872" aria-hidden="true" tabindex="-1"></a><span class="in">               nrow = 2)</span></span>
<span id="cb61-873"><a href="#cb61-873" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- portfolioplot(bas = "Paine Run", orderr = paineorder, type = "annual", wtryrs = c(2019:2022))</span></span>
<span id="cb61-874"><a href="#cb61-874" aria-hidden="true" tabindex="-1"></a><span class="in">denpa &lt;- ggarrange(p1, p2, ncol = 2, widths = c(0.7,1))</span></span>
<span id="cb61-875"><a href="#cb61-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-876"><a href="#cb61-876" aria-hidden="true" tabindex="-1"></a><span class="in"># Staunton</span></span>
<span id="cb61-877"><a href="#cb61-877" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- egg::ggarrange(portfolioplot(bas = "Staunton River", orderr = stauntorder, type = "interannual", wtryrs = c(2019:2022)),</span></span>
<span id="cb61-878"><a href="#cb61-878" aria-hidden="true" tabindex="-1"></a><span class="in">               portfolioplot(bas = "Staunton River", orderr = stauntorder, type = "scatter", wtryrs = c(2019:2022)),</span></span>
<span id="cb61-879"><a href="#cb61-879" aria-hidden="true" tabindex="-1"></a><span class="in">               nrow = 2)</span></span>
<span id="cb61-880"><a href="#cb61-880" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- portfolioplot(bas = "Staunton River", orderr = stauntorder, type = "annual", wtryrs = c(2019:2022))</span></span>
<span id="cb61-881"><a href="#cb61-881" aria-hidden="true" tabindex="-1"></a><span class="in">denst &lt;- ggarrange(p1, p2, ncol = 2, widths = c(0.7,1))</span></span>
<span id="cb61-882"><a href="#cb61-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-883"><a href="#cb61-883" aria-hidden="true" tabindex="-1"></a><span class="in"># Flathead</span></span>
<span id="cb61-884"><a href="#cb61-884" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- egg::ggarrange(portfolioplot(bas = "Flathead", orderr = flatorder, type = "interannual", wtryrs = c(2018:2024)),</span></span>
<span id="cb61-885"><a href="#cb61-885" aria-hidden="true" tabindex="-1"></a><span class="in">               portfolioplot(bas = "Flathead", orderr = flatorder, type = "scatter", wtryrs = c(2018:2024)),</span></span>
<span id="cb61-886"><a href="#cb61-886" aria-hidden="true" tabindex="-1"></a><span class="in">               nrow = 2)</span></span>
<span id="cb61-887"><a href="#cb61-887" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- portfolioplot(bas = "Flathead", orderr = flatorder, type = "annual", wtryrs = c(2018:2024))</span></span>
<span id="cb61-888"><a href="#cb61-888" aria-hidden="true" tabindex="-1"></a><span class="in">denfl &lt;- ggarrange(p1, p2, ncol = 2, widths = c(0.7,1))</span></span>
<span id="cb61-889"><a href="#cb61-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-890"><a href="#cb61-890" aria-hidden="true" tabindex="-1"></a><span class="in"># Yellowstone</span></span>
<span id="cb61-891"><a href="#cb61-891" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- egg::ggarrange(portfolioplot(bas = "Shields River", orderr = yellorder, type = "interannual", wtryrs = c(2016:2020,2022:2024)),</span></span>
<span id="cb61-892"><a href="#cb61-892" aria-hidden="true" tabindex="-1"></a><span class="in">               portfolioplot(bas = "Shields River", orderr = yellorder, type = "scatter", wtryrs = c(2016:2020,2022:2024)),</span></span>
<span id="cb61-893"><a href="#cb61-893" aria-hidden="true" tabindex="-1"></a><span class="in">               nrow = 2)</span></span>
<span id="cb61-894"><a href="#cb61-894" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- portfolioplot(bas = "Shields River", orderr = yellorder, type = "annual", wtryrs = c(2016:2020,2022:2024))</span></span>
<span id="cb61-895"><a href="#cb61-895" aria-hidden="true" tabindex="-1"></a><span class="in">denye &lt;- ggarrange(p1, p2, ncol = 2, widths = c(0.7,1))</span></span>
<span id="cb61-896"><a href="#cb61-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-897"><a href="#cb61-897" aria-hidden="true" tabindex="-1"></a><span class="in"># Snake River</span></span>
<span id="cb61-898"><a href="#cb61-898" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- egg::ggarrange(portfolioplot(bas = "Snake River", orderr = snakeorder, type = "interannual", wtryrs = c(2016:2024)),</span></span>
<span id="cb61-899"><a href="#cb61-899" aria-hidden="true" tabindex="-1"></a><span class="in">               portfolioplot(bas = "Snake River", orderr = snakeorder, type = "scatter", wtryrs = c(2016:2024)),</span></span>
<span id="cb61-900"><a href="#cb61-900" aria-hidden="true" tabindex="-1"></a><span class="in">               nrow = 2)</span></span>
<span id="cb61-901"><a href="#cb61-901" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- portfolioplot(bas = "Snake River", orderr = snakeorder, type = "annual", wtryrs = c(2016:2024))</span></span>
<span id="cb61-902"><a href="#cb61-902" aria-hidden="true" tabindex="-1"></a><span class="in">densn &lt;- ggarrange(p1, p2, ncol = 2, widths = c(0.7,1))</span></span>
<span id="cb61-903"><a href="#cb61-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-904"><a href="#cb61-904" aria-hidden="true" tabindex="-1"></a><span class="in"># Donner Blitzen</span></span>
<span id="cb61-905"><a href="#cb61-905" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- egg::ggarrange(portfolioplot(bas = "Donner Blitzen", orderr = donnerorder, type = "interannual", wtryrs = c(2016:2024)),</span></span>
<span id="cb61-906"><a href="#cb61-906" aria-hidden="true" tabindex="-1"></a><span class="in">               portfolioplot(bas = "Donner Blitzen", orderr = donnerorder, type = "scatter", wtryrs = c(2016:2024)),</span></span>
<span id="cb61-907"><a href="#cb61-907" aria-hidden="true" tabindex="-1"></a><span class="in">               nrow = 2)</span></span>
<span id="cb61-908"><a href="#cb61-908" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- portfolioplot(bas = "Donner Blitzen", orderr = donnerorder, type = "annual", wtryrs = c(2016:2024))</span></span>
<span id="cb61-909"><a href="#cb61-909" aria-hidden="true" tabindex="-1"></a><span class="in">dendb &lt;- ggarrange(p1, p2, ncol = 2, widths = c(0.7,1))</span></span>
<span id="cb61-910"><a href="#cb61-910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-911"><a href="#cb61-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-912"><a href="#cb61-912" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb61-913"><a href="#cb61-913" aria-hidden="true" tabindex="-1"></a><span class="fu">##### West Brook</span></span>
<span id="cb61-914"><a href="#cb61-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=5}</span></span>
<span id="cb61-915"><a href="#cb61-915" aria-hidden="true" tabindex="-1"></a><span class="in">denwb</span></span>
<span id="cb61-916"><a href="#cb61-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-917"><a href="#cb61-917" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Paine Run</span></span>
<span id="cb61-918"><a href="#cb61-918" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=5}</span></span>
<span id="cb61-919"><a href="#cb61-919" aria-hidden="true" tabindex="-1"></a><span class="in">denpa</span></span>
<span id="cb61-920"><a href="#cb61-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-921"><a href="#cb61-921" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Staunton River</span></span>
<span id="cb61-922"><a href="#cb61-922" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=5}</span></span>
<span id="cb61-923"><a href="#cb61-923" aria-hidden="true" tabindex="-1"></a><span class="in">denst</span></span>
<span id="cb61-924"><a href="#cb61-924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-925"><a href="#cb61-925" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Flathead</span></span>
<span id="cb61-926"><a href="#cb61-926" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=5}</span></span>
<span id="cb61-927"><a href="#cb61-927" aria-hidden="true" tabindex="-1"></a><span class="in">denfl</span></span>
<span id="cb61-928"><a href="#cb61-928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-929"><a href="#cb61-929" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Yellowstone</span></span>
<span id="cb61-930"><a href="#cb61-930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=5}</span></span>
<span id="cb61-931"><a href="#cb61-931" aria-hidden="true" tabindex="-1"></a><span class="in">denye</span></span>
<span id="cb61-932"><a href="#cb61-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-933"><a href="#cb61-933" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Snake River</span></span>
<span id="cb61-934"><a href="#cb61-934" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=5}</span></span>
<span id="cb61-935"><a href="#cb61-935" aria-hidden="true" tabindex="-1"></a><span class="in">densn</span></span>
<span id="cb61-936"><a href="#cb61-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-937"><a href="#cb61-937" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Donner Blitzen</span></span>
<span id="cb61-938"><a href="#cb61-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=5}</span></span>
<span id="cb61-939"><a href="#cb61-939" aria-hidden="true" tabindex="-1"></a><span class="in">dendb</span></span>
<span id="cb61-940"><a href="#cb61-940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-941"><a href="#cb61-941" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-942"><a href="#cb61-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-943"><a href="#cb61-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-944"><a href="#cb61-944" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model heterogeneity</span></span>
<span id="cb61-945"><a href="#cb61-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-946"><a href="#cb61-946" aria-hidden="true" tabindex="-1"></a>How does regional water availability affect spatial streamflow heterogeneity (relative difference range of streamflow values, headwaters vs. reference gages)?</span>
<span id="cb61-947"><a href="#cb61-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-948"><a href="#cb61-948" aria-hidden="true" tabindex="-1"></a>Set color palette</span>
<span id="cb61-951"><a href="#cb61-951" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-952"><a href="#cb61-952" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">7</span>, <span class="st">"Set2"</span>)</span>
<span id="cb61-953"><a href="#cb61-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-954"><a href="#cb61-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-955"><a href="#cb61-955" aria-hidden="true" tabindex="-1"></a>Some data manipulation</span>
<span id="cb61-958"><a href="#cb61-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-959"><a href="#cb61-959" aria-hidden="true" tabindex="-1"></a><span class="co"># define basin-years to keep</span></span>
<span id="cb61-960"><a href="#cb61-960" aria-hidden="true" tabindex="-1"></a>keepyears <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb61-961"><a href="#cb61-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"West Brook"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2020</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb61-962"><a href="#cb61-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Paine Run"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2022</span>)),</span>
<span id="cb61-963"><a href="#cb61-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Staunton River"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2022</span>)),</span>
<span id="cb61-964"><a href="#cb61-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Flathead"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2018</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb61-965"><a href="#cb61-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Shields River"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2020</span>,<span class="dv">2022</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb61-966"><a href="#cb61-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Snake River"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb61-967"><a href="#cb61-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">basin =</span> <span class="st">"Donner Blitzen"</span>, <span class="at">WaterYear =</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2024</span>)),</span>
<span id="cb61-968"><a href="#cb61-968" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">keep =</span> <span class="st">"yes"</span>)</span>
<span id="cb61-969"><a href="#cb61-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-970"><a href="#cb61-970" aria-hidden="true" tabindex="-1"></a><span class="co"># standard deviation of median summer flow</span></span>
<span id="cb61-971"><a href="#cb61-971" aria-hidden="true" tabindex="-1"></a><span class="co"># dat_clean %&gt;%</span></span>
<span id="cb61-972"><a href="#cb61-972" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-973"><a href="#cb61-973" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(basin, site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-974"><a href="#cb61-974" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(medyield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-975"><a href="#cb61-975" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb61-976"><a href="#cb61-976" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(basin, WaterYear) %&gt;%</span></span>
<span id="cb61-977"><a href="#cb61-977" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(sdyield = sd(medyield), nsites = n()) %&gt;%</span></span>
<span id="cb61-978"><a href="#cb61-978" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb61-979"><a href="#cb61-979" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(wateravail %&gt;% select(basin, WaterYear, totalyield:tyz_sum_perc)) %&gt;%</span></span>
<span id="cb61-980"><a href="#cb61-980" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(keepyears) %&gt;% filter(keep == "yes") %&gt;%</span></span>
<span id="cb61-981"><a href="#cb61-981" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(basin = ifelse(basin == "Shields River", "Yellowstone River",</span></span>
<span id="cb61-982"><a href="#cb61-982" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ifelse(basin == "Flathead", "Flathead River", basin))) %&gt;%</span></span>
<span id="cb61-983"><a href="#cb61-983" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(basin = factor(basin, levels = c("West Brook", "Piney River", "Staunton River", "Paine Run", "Flathead River", "Yellowstone River", "Snake River", "Donner Blitzen"))) %&gt;%</span></span>
<span id="cb61-984"><a href="#cb61-984" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = tyz_sum_perc, y = sdyield)) +</span></span>
<span id="cb61-985"><a href="#cb61-985" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_smooth(method = "lm", color = "black", aes(weight = nsites)) +</span></span>
<span id="cb61-986"><a href="#cb61-986" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(aes(fill = basin, size = nsites), shape = 21) +</span></span>
<span id="cb61-987"><a href="#cb61-987" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(palette = "Set2") +</span></span>
<span id="cb61-988"><a href="#cb61-988" aria-hidden="true" tabindex="-1"></a><span class="co">#   #facet_wrap(~basin) +</span></span>
<span id="cb61-989"><a href="#cb61-989" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw() + theme(panel.grid = element_blank())</span></span>
<span id="cb61-990"><a href="#cb61-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-991"><a href="#cb61-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-992"><a href="#cb61-992" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate relative difference in range as above</span></span>
<span id="cb61-993"><a href="#cb61-993" aria-hidden="true" tabindex="-1"></a>mydat <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb61-994"><a href="#cb61-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-995"><a href="#cb61-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb61-996"><a href="#cb61-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb61-997"><a href="#cb61-997" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb61-998"><a href="#cb61-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-999"><a href="#cb61-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat_clean_big <span class="sc">%&gt;%</span> </span>
<span id="cb61-1000"><a href="#cb61-1000" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-1001"><a href="#cb61-1001" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb61-1002"><a href="#cb61-1002" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(logYield)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(logYield)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb61-1003"><a href="#cb61-1003" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb61-1004"><a href="#cb61-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-1005"><a href="#cb61-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield<span class="sc">:</span>tyz_sum_perc)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1006"><a href="#cb61-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(keepyears) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(keep <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-1007"><a href="#cb61-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Shields River"</span>, <span class="st">"Yellowstone River"</span>,</span>
<span id="cb61-1008"><a href="#cb61-1008" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Flathead"</span>, <span class="st">"Flathead River"</span>, </span>
<span id="cb61-1009"><a href="#cb61-1009" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Donner Blitzen"</span>, <span class="st">"Donner-Blitzen River"</span>, basin)))) <span class="sc">%&gt;%</span></span>
<span id="cb61-1010"><a href="#cb61-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">factor</span>(basin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Staunton River"</span>, <span class="st">"Paine Run"</span>, </span>
<span id="cb61-1011"><a href="#cb61-1011" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Flathead River"</span>, <span class="st">"Yellowstone River"</span>, <span class="st">"Snake River"</span>, <span class="st">"Donner-Blitzen River"</span>))) </span>
<span id="cb61-1012"><a href="#cb61-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1013"><a href="#cb61-1013" aria-hidden="true" tabindex="-1"></a>mydat</span>
<span id="cb61-1014"><a href="#cb61-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1015"><a href="#cb61-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1016"><a href="#cb61-1016" aria-hidden="true" tabindex="-1"></a>Show simple linear model summary, weighted by number of sites</span>
<span id="cb61-1019"><a href="#cb61-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1020"><a href="#cb61-1020" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(pe_range <span class="sc">~</span> tyz_sum_perc, <span class="at">data =</span> mydat, <span class="at">weights =</span> nsites))</span>
<span id="cb61-1021"><a href="#cb61-1021" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1022"><a href="#cb61-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1023"><a href="#cb61-1023" aria-hidden="true" tabindex="-1"></a>Show distribution of spatial streamflow heterogeneity by basin. Lots of structuring by basin, driven in large part by Staunton and Donner-Blitzen Rivers.</span>
<span id="cb61-1026"><a href="#cb61-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1027"><a href="#cb61-1027" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>))</span>
<span id="cb61-1028"><a href="#cb61-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(pe_range <span class="sc">~</span> basin, <span class="at">data =</span> mydat, <span class="at">ylab =</span> <span class="st">"Spatial streamflow heterogeneity"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">las =</span> <span class="dv">2</span>, <span class="at">col =</span> mycols)</span>
<span id="cb61-1029"><a href="#cb61-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1030"><a href="#cb61-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1031"><a href="#cb61-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1032"><a href="#cb61-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit model </span></span>
<span id="cb61-1033"><a href="#cb61-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1034"><a href="#cb61-1034" aria-hidden="true" tabindex="-1"></a>Use a random slope/random intercept mixed effects model to estimate the among-basin mean effect of regional water availability on spatial streamflow heterogeneity.</span>
<span id="cb61-1035"><a href="#cb61-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1036"><a href="#cb61-1036" aria-hidden="true" tabindex="-1"></a>**Notes:**</span>
<span id="cb61-1037"><a href="#cb61-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1038"><a href="#cb61-1038" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>This regression is not weighted by number of headwater sites used to calculate spatial heterogeneity because variance decomposition using *rptR* does not support use of weights.</span>
<span id="cb61-1039"><a href="#cb61-1039" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>This uses z-scored x-values...using the raw percentiles leads to model convergence issues</span>
<span id="cb61-1040"><a href="#cb61-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1043"><a href="#cb61-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1044"><a href="#cb61-1044" aria-hidden="true" tabindex="-1"></a>mydat <span class="ot">&lt;-</span> mydat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">scale</span>(tyz_sum_perc))</span>
<span id="cb61-1045"><a href="#cb61-1045" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(pe_range <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat)</span>
<span id="cb61-1046"><a href="#cb61-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span>
<span id="cb61-1047"><a href="#cb61-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1048"><a href="#cb61-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1049"><a href="#cb61-1049" aria-hidden="true" tabindex="-1"></a>Get p-values for global slope and intercept: (doesn't to run in Quarto...works fine in R)</span>
<span id="cb61-1052"><a href="#cb61-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1053"><a href="#cb61-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(<span class="fu">as_lmerModLmerTest</span>(lmod)))</span>
<span id="cb61-1054"><a href="#cb61-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1055"><a href="#cb61-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1056"><a href="#cb61-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1057"><a href="#cb61-1057" aria-hidden="true" tabindex="-1"></a>Plot relationship between spatial streamflow heterogeneity and regional water availability with global (among-population mean) regression line. </span>
<span id="cb61-1058"><a href="#cb61-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width = 5, fig.height = 4}</span></span>
<span id="cb61-1059"><a href="#cb61-1059" aria-hidden="true" tabindex="-1"></a><span class="in"># get predicted values and 95% credible interval</span></span>
<span id="cb61-1060"><a href="#cb61-1060" aria-hidden="true" tabindex="-1"></a><span class="in">effects_tyz &lt;- effects::effect(term = "z_tyz_sum_perc", mod = as_lmerModLmerTest(lmod), xlevels = list(z_tyz_sum_perc = seq(min(mydat$z_tyz_sum_perc), max(mydat$z_tyz_sum_perc), length.out = 1000)), se = list(level = 0.95))</span></span>
<span id="cb61-1061"><a href="#cb61-1061" aria-hidden="true" tabindex="-1"></a><span class="in">x_tyz &lt;- as_tibble(effects_tyz) %&gt;% mutate(tyz_sum_perc = (z_tyz_sum_perc * attr(mydat$z_tyz_sum_perc, "scaled:scale")) + attr(mydat$z_tyz_sum_perc, "scaled:center"))</span></span>
<span id="cb61-1062"><a href="#cb61-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1063"><a href="#cb61-1063" aria-hidden="true" tabindex="-1"></a><span class="in"># trim data for panel labesl</span></span>
<span id="cb61-1064"><a href="#cb61-1064" aria-hidden="true" tabindex="-1"></a><span class="in">mydat_labs &lt;- bind_rows(mydat %&gt;% filter(basin == "West Brook", WaterYear %in% c(2020,2021)),</span></span>
<span id="cb61-1065"><a href="#cb61-1065" aria-hidden="true" tabindex="-1"></a><span class="in">                        mydat %&gt;% filter(basin == "Snake River", WaterYear %in% c(2021,2022))) %&gt;%</span></span>
<span id="cb61-1066"><a href="#cb61-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(labs = c("b", "c", "d", "e"))</span></span>
<span id="cb61-1067"><a href="#cb61-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1068"><a href="#cb61-1068" aria-hidden="true" tabindex="-1"></a><span class="in"># plot </span></span>
<span id="cb61-1069"><a href="#cb61-1069" aria-hidden="true" tabindex="-1"></a><span class="in">randiffplot &lt;- ggplot() + </span></span>
<span id="cb61-1070"><a href="#cb61-1070" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(data = x_tyz, aes(x = tyz_sum_perc, ymin = lower, ymax = upper), fill = "grey80") +</span></span>
<span id="cb61-1071"><a href="#cb61-1071" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = x_tyz, aes(x = tyz_sum_perc, y = fit), color = "black", size = 1.25, lineend = "round") +</span></span>
<span id="cb61-1072"><a href="#cb61-1072" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = mydat, aes(x = tyz_sum_perc, y = pe_range, fill = basin, size = nsites), shape = 21) + </span></span>
<span id="cb61-1073"><a href="#cb61-1073" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_brewer(palette = "Set2") +</span></span>
<span id="cb61-1074"><a href="#cb61-1074" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(data = mydat_labs, aes(x = tyz_sum_perc, y = pe_range, label = labs), size = 3) +</span></span>
<span id="cb61-1075"><a href="#cb61-1075" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(panel.grid = element_blank(), axis.text = element_text(color = "black")) +</span></span>
<span id="cb61-1076"><a href="#cb61-1076" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Spatial streamflow heterogeneity (percent difference)") + xlab("Water availability (percentile)") +</span></span>
<span id="cb61-1077"><a href="#cb61-1077" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = guide_legend(title = "Basin", override.aes = list(size = 5), order = 1), size = guide_legend(title = "Number of sites", order = 2)) +</span></span>
<span id="cb61-1078"><a href="#cb61-1078" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_abline(intercept = 0, slope = 0, linetype = "dashed")</span></span>
<span id="cb61-1079"><a href="#cb61-1079" aria-hidden="true" tabindex="-1"></a><span class="in">randiffplot</span></span>
<span id="cb61-1080"><a href="#cb61-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1081"><a href="#cb61-1081" aria-hidden="true" tabindex="-1"></a><span class="in"># write to file</span></span>
<span id="cb61-1082"><a href="#cb61-1082" aria-hidden="true" tabindex="-1"></a><span class="in"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_RangeDiff_allsites2.jpg", width = 4.75, height = 5, units = "in", res = 1000)</span></span>
<span id="cb61-1083"><a href="#cb61-1083" aria-hidden="true" tabindex="-1"></a><span class="in"># randiffplot</span></span>
<span id="cb61-1084"><a href="#cb61-1084" aria-hidden="true" tabindex="-1"></a><span class="in"># dev.off()</span></span>
<span id="cb61-1085"><a href="#cb61-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1086"><a href="#cb61-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1087"><a href="#cb61-1087" aria-hidden="true" tabindex="-1"></a>Use *rptR* to decompose variance in spatial streamflow heterogeneity into fixed (regional water availability) and random (basin) effect sources:</span>
<span id="cb61-1088"><a href="#cb61-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb61-1089"><a href="#cb61-1089" aria-hidden="true" tabindex="-1"></a><span class="in">rmod &lt;- rptGaussian(pe_range ~ z_tyz_sum_perc + (1 + z_tyz_sum_perc | basin), data = mydat, grname = c("basin", "Fixed"), ratio = TRUE, adjusted = FALSE, nboot = 1000)</span></span>
<span id="cb61-1090"><a href="#cb61-1090" aria-hidden="true" tabindex="-1"></a><span class="in">print(rmod)</span></span>
<span id="cb61-1091"><a href="#cb61-1091" aria-hidden="true" tabindex="-1"></a><span class="in">rmod$mod</span></span>
<span id="cb61-1092"><a href="#cb61-1092" aria-hidden="true" tabindex="-1"></a><span class="in">plot(rmod, grname = "basin")</span></span>
<span id="cb61-1093"><a href="#cb61-1093" aria-hidden="true" tabindex="-1"></a><span class="in">plot(rmod, grname = "Fixed")</span></span>
<span id="cb61-1094"><a href="#cb61-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1095"><a href="#cb61-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1096"><a href="#cb61-1096" aria-hidden="true" tabindex="-1"></a>The strong effect of basin is largely driven by Staunton and Donner-Blitzen Rivers. Without those basins, random effect variance shrinks and fixed effect variance expands considerably. Much of this pattern is likely due to low sample sizes (few headwater gages in these basins, particularly in the Donner-Blitzen)</span>
<span id="cb61-1097"><a href="#cb61-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb61-1098"><a href="#cb61-1098" aria-hidden="true" tabindex="-1"></a><span class="in">rmod &lt;- rptGaussian(pe_range ~ z_tyz_sum_perc + (1 + z_tyz_sum_perc | basin), data = mydat %&gt;% filter(!basin %in% c("Staunton River", "Donner-Blitzen River")), grname = c("basin", "Fixed"), ratio = TRUE, adjusted = FALSE, nboot = 1000)</span></span>
<span id="cb61-1099"><a href="#cb61-1099" aria-hidden="true" tabindex="-1"></a><span class="in">print(rmod)</span></span>
<span id="cb61-1100"><a href="#cb61-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1101"><a href="#cb61-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1102"><a href="#cb61-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1103"><a href="#cb61-1103" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sensitivity analysis</span></span>
<span id="cb61-1104"><a href="#cb61-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1105"><a href="#cb61-1105" aria-hidden="true" tabindex="-1"></a>How sensitive are these results to the choice of data (log) transformation, per comments from John Hammond during USGS internal review?</span>
<span id="cb61-1106"><a href="#cb61-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1107"><a href="#cb61-1107" aria-hidden="true" tabindex="-1"></a>Summary: While the among-network mean effect of water availability on heterogeneity was less significant using un-logged discharge data (p &gt; 0.05), this appeared to be driven by the highly non-normal distribution of raw discharge values, as the reviewer indicated. Importantly, the magnitude of the effect is similar and the qualitative results are unchanged (negative slope). </span>
<span id="cb61-1108"><a href="#cb61-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1109"><a href="#cb61-1109" aria-hidden="true" tabindex="-1"></a>Data manipulation: use un-logged/raw Yield data to calculation spatial heterogeneity, also use CV rather than ranges</span>
<span id="cb61-1112"><a href="#cb61-1112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1113"><a href="#cb61-1113" aria-hidden="true" tabindex="-1"></a>mydat2 <span class="ot">&lt;-</span> dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb61-1114"><a href="#cb61-1114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1115"><a href="#cb61-1115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb61-1116"><a href="#cb61-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">nsites =</span> <span class="fu">length</span>(<span class="fu">unique</span>(site_name)),</span>
<span id="cb61-1117"><a href="#cb61-1117" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlerange =</span> <span class="fu">range</span>(Yield_mm)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(Yield_mm)[<span class="dv">1</span>],</span>
<span id="cb61-1118"><a href="#cb61-1118" aria-hidden="true" tabindex="-1"></a>            <span class="at">littlecv =</span> <span class="fu">sd</span>(Yield_mm)<span class="sc">/</span><span class="fu">mean</span>(Yield_mm)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-1119"><a href="#cb61-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-1120"><a href="#cb61-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat_clean_big <span class="sc">%&gt;%</span> </span>
<span id="cb61-1121"><a href="#cb61-1121" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-1122"><a href="#cb61-1122" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(basin, WaterYear) <span class="sc">%&gt;%</span> </span>
<span id="cb61-1123"><a href="#cb61-1123" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarize</span>(<span class="at">bigrange =</span> <span class="fu">range</span>(Yield_mm)[<span class="dv">2</span>]<span class="sc">-</span><span class="fu">range</span>(Yield_mm)[<span class="dv">1</span>],</span>
<span id="cb61-1124"><a href="#cb61-1124" aria-hidden="true" tabindex="-1"></a>                        <span class="at">bigcv =</span> <span class="fu">sd</span>(Yield_mm)<span class="sc">/</span><span class="fu">mean</span>(Yield_mm)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1125"><a href="#cb61-1125" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb61-1126"><a href="#cb61-1126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pe_range =</span> ((littlerange<span class="sc">-</span>bigrange)<span class="sc">/</span>bigrange)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb61-1127"><a href="#cb61-1127" aria-hidden="true" tabindex="-1"></a>         <span class="at">pe_cv =</span> ((littlecv<span class="sc">-</span>bigcv)<span class="sc">/</span>bigcv)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-1128"><a href="#cb61-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wateravail <span class="sc">%&gt;%</span> <span class="fu">select</span>(basin, WaterYear, totalyield<span class="sc">:</span>tyz_sum_perc)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1129"><a href="#cb61-1129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(keepyears) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(keep <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-1130"><a href="#cb61-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Shields River"</span>, <span class="st">"Yellowstone River"</span>,</span>
<span id="cb61-1131"><a href="#cb61-1131" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Flathead"</span>, <span class="st">"Flathead River"</span>, </span>
<span id="cb61-1132"><a href="#cb61-1132" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(basin <span class="sc">==</span> <span class="st">"Donner Blitzen"</span>, <span class="st">"Donner-Blitzen River"</span>, basin)))) <span class="sc">%&gt;%</span></span>
<span id="cb61-1133"><a href="#cb61-1133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">basin =</span> <span class="fu">factor</span>(basin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook"</span>, <span class="st">"Staunton River"</span>, <span class="st">"Paine Run"</span>, </span>
<span id="cb61-1134"><a href="#cb61-1134" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Flathead River"</span>, <span class="st">"Yellowstone River"</span>, <span class="st">"Snake River"</span>, <span class="st">"Donner-Blitzen River"</span>))) </span>
<span id="cb61-1135"><a href="#cb61-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1136"><a href="#cb61-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1137"><a href="#cb61-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1138"><a href="#cb61-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Range, un-logged</span></span>
<span id="cb61-1139"><a href="#cb61-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1140"><a href="#cb61-1140" aria-hidden="true" tabindex="-1"></a>Fit the mixed effects model</span>
<span id="cb61-1143"><a href="#cb61-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1144"><a href="#cb61-1144" aria-hidden="true" tabindex="-1"></a>mydat2 <span class="ot">&lt;-</span> mydat2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">scale</span>(tyz_sum_perc))</span>
<span id="cb61-1145"><a href="#cb61-1145" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(pe_range <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat2)</span>
<span id="cb61-1146"><a href="#cb61-1146" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span>
<span id="cb61-1147"><a href="#cb61-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1148"><a href="#cb61-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1149"><a href="#cb61-1149" aria-hidden="true" tabindex="-1"></a>Plot</span>
<span id="cb61-1152"><a href="#cb61-1152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1153"><a href="#cb61-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># get predicted values and 95% credible interval</span></span>
<span id="cb61-1154"><a href="#cb61-1154" aria-hidden="true" tabindex="-1"></a>effects_tyz <span class="ot">&lt;-</span> effects<span class="sc">::</span><span class="fu">effect</span>(<span class="at">term =</span> <span class="st">"z_tyz_sum_perc"</span>, <span class="at">mod =</span> <span class="fu">as_lmerModLmerTest</span>(lmod), <span class="at">xlevels =</span> <span class="fu">list</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">seq</span>(<span class="fu">min</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="fu">max</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="at">length.out =</span> <span class="dv">1000</span>)), <span class="at">se =</span> <span class="fu">list</span>(<span class="at">level =</span> <span class="fl">0.95</span>))</span>
<span id="cb61-1155"><a href="#cb61-1155" aria-hidden="true" tabindex="-1"></a>x_tyz <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(effects_tyz) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tyz_sum_perc =</span> (z_tyz_sum_perc <span class="sc">*</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:scale"</span>)) <span class="sc">+</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:center"</span>))</span>
<span id="cb61-1156"><a href="#cb61-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1157"><a href="#cb61-1157" aria-hidden="true" tabindex="-1"></a><span class="co"># trim data for panel labesl</span></span>
<span id="cb61-1158"><a href="#cb61-1158" aria-hidden="true" tabindex="-1"></a>mydat_labs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"West Brook"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>)),</span>
<span id="cb61-1159"><a href="#cb61-1159" aria-hidden="true" tabindex="-1"></a>                        mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"Snake River"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb61-1160"><a href="#cb61-1160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labs =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>))</span>
<span id="cb61-1161"><a href="#cb61-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1162"><a href="#cb61-1162" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb61-1163"><a href="#cb61-1163" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb61-1164"><a href="#cb61-1164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb61-1165"><a href="#cb61-1165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb61-1166"><a href="#cb61-1166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mydat2, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_range, <span class="at">fill =</span> basin, <span class="at">size =</span> nsites), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb61-1167"><a href="#cb61-1167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb61-1168"><a href="#cb61-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb61-1169"><a href="#cb61-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Spatial streamflow heterogeneity (percent difference)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Water availability (percentile)"</span>) <span class="sc">+</span></span>
<span id="cb61-1170"><a href="#cb61-1170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Basin"</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">order =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Number of sites"</span>, <span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb61-1171"><a href="#cb61-1171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb61-1172"><a href="#cb61-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1173"><a href="#cb61-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1174"><a href="#cb61-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1175"><a href="#cb61-1175" aria-hidden="true" tabindex="-1"></a><span class="fu">#### CV</span></span>
<span id="cb61-1176"><a href="#cb61-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1177"><a href="#cb61-1177" aria-hidden="true" tabindex="-1"></a>Fig the mmixed effects model</span>
<span id="cb61-1180"><a href="#cb61-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1181"><a href="#cb61-1181" aria-hidden="true" tabindex="-1"></a>mydat2 <span class="ot">&lt;-</span> mydat2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">scale</span>(tyz_sum_perc))</span>
<span id="cb61-1182"><a href="#cb61-1182" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(pe_cv <span class="sc">~</span> z_tyz_sum_perc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> z_tyz_sum_perc <span class="sc">|</span> basin), <span class="at">data =</span> mydat2)</span>
<span id="cb61-1183"><a href="#cb61-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span>
<span id="cb61-1184"><a href="#cb61-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1185"><a href="#cb61-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1186"><a href="#cb61-1186" aria-hidden="true" tabindex="-1"></a>Plot</span>
<span id="cb61-1189"><a href="#cb61-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1190"><a href="#cb61-1190" aria-hidden="true" tabindex="-1"></a><span class="co"># get predicted values and 95% credible interval</span></span>
<span id="cb61-1191"><a href="#cb61-1191" aria-hidden="true" tabindex="-1"></a>effects_tyz <span class="ot">&lt;-</span> effects<span class="sc">::</span><span class="fu">effect</span>(<span class="at">term =</span> <span class="st">"z_tyz_sum_perc"</span>, <span class="at">mod =</span> <span class="fu">as_lmerModLmerTest</span>(lmod), <span class="at">xlevels =</span> <span class="fu">list</span>(<span class="at">z_tyz_sum_perc =</span> <span class="fu">seq</span>(<span class="fu">min</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="fu">max</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc), <span class="at">length.out =</span> <span class="dv">1000</span>)), <span class="at">se =</span> <span class="fu">list</span>(<span class="at">level =</span> <span class="fl">0.95</span>))</span>
<span id="cb61-1192"><a href="#cb61-1192" aria-hidden="true" tabindex="-1"></a>x_tyz <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(effects_tyz) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tyz_sum_perc =</span> (z_tyz_sum_perc <span class="sc">*</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:scale"</span>)) <span class="sc">+</span> <span class="fu">attr</span>(mydat2<span class="sc">$</span>z_tyz_sum_perc, <span class="st">"scaled:center"</span>))</span>
<span id="cb61-1193"><a href="#cb61-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1194"><a href="#cb61-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># trim data for panel labesl</span></span>
<span id="cb61-1195"><a href="#cb61-1195" aria-hidden="true" tabindex="-1"></a>mydat_labs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"West Brook"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>)),</span>
<span id="cb61-1196"><a href="#cb61-1196" aria-hidden="true" tabindex="-1"></a>                        mydat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"Snake River"</span>, WaterYear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb61-1197"><a href="#cb61-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labs =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>))</span>
<span id="cb61-1198"><a href="#cb61-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1199"><a href="#cb61-1199" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb61-1200"><a href="#cb61-1200" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb61-1201"><a href="#cb61-1201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb61-1202"><a href="#cb61-1202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> x_tyz, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb61-1203"><a href="#cb61-1203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mydat2, <span class="fu">aes</span>(<span class="at">x =</span> tyz_sum_perc, <span class="at">y =</span> pe_cv, <span class="at">fill =</span> basin, <span class="at">size =</span> nsites), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb61-1204"><a href="#cb61-1204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb61-1205"><a href="#cb61-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb61-1206"><a href="#cb61-1206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Spatial streamflow heterogeneity (percent difference)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Water availability (percentile)"</span>) <span class="sc">+</span></span>
<span id="cb61-1207"><a href="#cb61-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Basin"</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">order =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Number of sites"</span>, <span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb61-1208"><a href="#cb61-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb61-1209"><a href="#cb61-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1210"><a href="#cb61-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1211"><a href="#cb61-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1212"><a href="#cb61-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1213"><a href="#cb61-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1214"><a href="#cb61-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">## Paper figs</span></span>
<span id="cb61-1215"><a href="#cb61-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1216"><a href="#cb61-1216" aria-hidden="true" tabindex="-1"></a><span class="fu">### West Brook</span></span>
<span id="cb61-1217"><a href="#cb61-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1218"><a href="#cb61-1218" aria-hidden="true" tabindex="-1"></a>2020/2021 summer flow distributions</span>
<span id="cb61-1219"><a href="#cb61-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=2.75, fig.height=5}</span></span>
<span id="cb61-1220"><a href="#cb61-1220" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "West Brook"</span></span>
<span id="cb61-1221"><a href="#cb61-1221" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- wborder</span></span>
<span id="cb61-1222"><a href="#cb61-1222" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2020,2021)</span></span>
<span id="cb61-1223"><a href="#cb61-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1224"><a href="#cb61-1224" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-1225"><a href="#cb61-1225" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-1226"><a href="#cb61-1226" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-1227"><a href="#cb61-1227" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-1228"><a href="#cb61-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1229"><a href="#cb61-1229" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-1230"><a href="#cb61-1230" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-1231"><a href="#cb61-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1232"><a href="#cb61-1232" aria-hidden="true" tabindex="-1"></a><span class="in"># annual</span></span>
<span id="cb61-1233"><a href="#cb61-1233" aria-hidden="true" tabindex="-1"></a><span class="in">pann &lt;- ggplot() +</span></span>
<span id="cb61-1234"><a href="#cb61-1234" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(data = tempdat, aes(x = logYield, y = ..scaled.., color = site_name, fill = site_name), size = 0.8) +</span></span>
<span id="cb61-1235"><a href="#cb61-1235" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = cet_pal(nsites, name = "i1")) +</span></span>
<span id="cb61-1236"><a href="#cb61-1236" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = alpha(cet_pal(nsites, name = "i1"), 0.1)) +</span></span>
<span id="cb61-1237"><a href="#cb61-1237" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(data = tempdat_big, aes(x = logYield, y = ..scaled..), color = "grey40", fill = alpha("grey40", 0.2), size = 0.8) +</span></span>
<span id="cb61-1238"><a href="#cb61-1238" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Summer log(Yield, mm/day)") + ylab("Density") +</span></span>
<span id="cb61-1239"><a href="#cb61-1239" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), </span></span>
<span id="cb61-1240"><a href="#cb61-1240" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.text.y = element_blank(), axis.ticks.y = element_blank(),</span></span>
<span id="cb61-1241"><a href="#cb61-1241" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.text = element_text(color = "black"), legend.position = "none",</span></span>
<span id="cb61-1242"><a href="#cb61-1242" aria-hidden="true" tabindex="-1"></a><span class="in">                     strip.background = element_blank(), strip.text = element_blank()) +</span></span>
<span id="cb61-1243"><a href="#cb61-1243" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~factor(WaterYear, levels = as.numeric(unlist(pedat %&gt;% arrange(totalyield_sum_z) %&gt;% select(WaterYear)))), ncol = 1)</span></span>
<span id="cb61-1244"><a href="#cb61-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1245"><a href="#cb61-1245" aria-hidden="true" tabindex="-1"></a><span class="in">print(pann)</span></span>
<span id="cb61-1246"><a href="#cb61-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1247"><a href="#cb61-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1248"><a href="#cb61-1248" aria-hidden="true" tabindex="-1"></a><span class="in"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summerdensity_WB_annual.jpg", width = 2.75, height = 5, units = "in", res = 1000)</span></span>
<span id="cb61-1249"><a href="#cb61-1249" aria-hidden="true" tabindex="-1"></a><span class="in"># pann</span></span>
<span id="cb61-1250"><a href="#cb61-1250" aria-hidden="true" tabindex="-1"></a><span class="in"># dev.off()</span></span>
<span id="cb61-1251"><a href="#cb61-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1252"><a href="#cb61-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1253"><a href="#cb61-1253" aria-hidden="true" tabindex="-1"></a>2020/2021 summer flow distributions</span>
<span id="cb61-1254"><a href="#cb61-1254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=6}</span></span>
<span id="cb61-1255"><a href="#cb61-1255" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "West Brook"</span></span>
<span id="cb61-1256"><a href="#cb61-1256" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- wborder</span></span>
<span id="cb61-1257"><a href="#cb61-1257" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2020,2021)</span></span>
<span id="cb61-1258"><a href="#cb61-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1259"><a href="#cb61-1259" aria-hidden="true" tabindex="-1"></a><span class="in"># sheds and network</span></span>
<span id="cb61-1260"><a href="#cb61-1260" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Mass_Watersheds.shp")</span></span>
<span id="cb61-1261"><a href="#cb61-1261" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "WBR",]</span></span>
<span id="cb61-1262"><a href="#cb61-1262" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Mass_Streams.shp")</span></span>
<span id="cb61-1263"><a href="#cb61-1263" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-1264"><a href="#cb61-1264" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-1265"><a href="#cb61-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1266"><a href="#cb61-1266" aria-hidden="true" tabindex="-1"></a><span class="in"># get lakes</span></span>
<span id="cb61-1267"><a href="#cb61-1267" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- get_waterbodies(AOI = siteinfo_sp %&gt;% filter(site_name == "West Brook NWIS"), buffer = 10000)</span></span>
<span id="cb61-1268"><a href="#cb61-1268" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- lakes %&gt;% filter(gnis_name %in% c("Northampton Reservoir Upper", "Northampton Reservoir"))</span></span>
<span id="cb61-1269"><a href="#cb61-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1270"><a href="#cb61-1270" aria-hidden="true" tabindex="-1"></a><span class="in"># little g points</span></span>
<span id="cb61-1271"><a href="#cb61-1271" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% wborder) %&gt;% mutate(site_name = factor(site_name, levels = wborder))</span></span>
<span id="cb61-1272"><a href="#cb61-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1273"><a href="#cb61-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1274"><a href="#cb61-1274" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-1275"><a href="#cb61-1275" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-1276"><a href="#cb61-1276" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-1277"><a href="#cb61-1277" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-1278"><a href="#cb61-1278" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-1279"><a href="#cb61-1279" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-1280"><a href="#cb61-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1281"><a href="#cb61-1281" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-1282"><a href="#cb61-1282" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-1283"><a href="#cb61-1283" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-1284"><a href="#cb61-1284" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-1285"><a href="#cb61-1285" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-1286"><a href="#cb61-1286" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-1287"><a href="#cb61-1287" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-1288"><a href="#cb61-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1289"><a href="#cb61-1289" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-1290"><a href="#cb61-1290" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-1291"><a href="#cb61-1291" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-1292"><a href="#cb61-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1293"><a href="#cb61-1293" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-1294"><a href="#cb61-1294" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-1295"><a href="#cb61-1295" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-1296"><a href="#cb61-1296" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-1297"><a href="#cb61-1297" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-1298"><a href="#cb61-1298" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-1299"><a href="#cb61-1299" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-1300"><a href="#cb61-1300" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-1301"><a href="#cb61-1301" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-1302"><a href="#cb61-1302" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-1303"><a href="#cb61-1303" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-1304"><a href="#cb61-1304" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-1305"><a href="#cb61-1305" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-1306"><a href="#cb61-1306" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-1307"><a href="#cb61-1307" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-1308"><a href="#cb61-1308" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-1309"><a href="#cb61-1309" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-1310"><a href="#cb61-1310" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-1311"><a href="#cb61-1311" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-1312"><a href="#cb61-1312" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-1313"><a href="#cb61-1313" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-1314"><a href="#cb61-1314" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-1315"><a href="#cb61-1315" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-1316"><a href="#cb61-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1317"><a href="#cb61-1317" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-1318"><a href="#cb61-1318" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-1319"><a href="#cb61-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1320"><a href="#cb61-1320" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-1321"><a href="#cb61-1321" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_wb &lt;- list()</span></span>
<span id="cb61-1322"><a href="#cb61-1322" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-1323"><a href="#cb61-1323" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-1324"><a href="#cb61-1324" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-1325"><a href="#cb61-1325" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_wb[[i]] &lt;- local({</span></span>
<span id="cb61-1326"><a href="#cb61-1326" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-1327"><a href="#cb61-1327" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-1328"><a href="#cb61-1328" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-1329"><a href="#cb61-1329" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-1330"><a href="#cb61-1330" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-1331"><a href="#cb61-1331" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-1332"><a href="#cb61-1332" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-1333"><a href="#cb61-1333" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = lakes, color = "white", fill = "lightskyblue1", linewidth = 0.7) +</span></span>
<span id="cb61-1334"><a href="#cb61-1334" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = lakes, color = "royalblue4", fill = "lightskyblue1", linewidth = 0.5) +</span></span>
<span id="cb61-1335"><a href="#cb61-1335" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-1336"><a href="#cb61-1336" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-1337"><a href="#cb61-1337" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-1338"><a href="#cb61-1338" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-1339"><a href="#cb61-1339" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_void() + scale_x_continuous(expand = c(0.003, 0.003)) + scale_y_continuous(expand = c(0.002, 0.002))</span></span>
<span id="cb61-1340"><a href="#cb61-1340" aria-hidden="true" tabindex="-1"></a><span class="in">      #annotate("label", x = Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = 1.05, size = 5)</span></span>
<span id="cb61-1341"><a href="#cb61-1341" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb61-1342"><a href="#cb61-1342" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-1343"><a href="#cb61-1343" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- ggarrange(plotlist = plotlist_wb, common.legend = TRUE, legend = "right", nrow = 2)</span></span>
<span id="cb61-1344"><a href="#cb61-1344" aria-hidden="true" tabindex="-1"></a><span class="in">print(p)</span></span>
<span id="cb61-1345"><a href="#cb61-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1346"><a href="#cb61-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1347"><a href="#cb61-1347" aria-hidden="true" tabindex="-1"></a><span class="in"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summermedianmap_WB_annual.jpg", width = 4, height = 6, units = "in", res = 1000)</span></span>
<span id="cb61-1348"><a href="#cb61-1348" aria-hidden="true" tabindex="-1"></a><span class="in"># p</span></span>
<span id="cb61-1349"><a href="#cb61-1349" aria-hidden="true" tabindex="-1"></a><span class="in"># dev.off()</span></span>
<span id="cb61-1350"><a href="#cb61-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1351"><a href="#cb61-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1352"><a href="#cb61-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1353"><a href="#cb61-1353" aria-hidden="true" tabindex="-1"></a><span class="fu">### Snake River</span></span>
<span id="cb61-1354"><a href="#cb61-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1355"><a href="#cb61-1355" aria-hidden="true" tabindex="-1"></a>2021/2022 summer flow distributions</span>
<span id="cb61-1356"><a href="#cb61-1356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=2.75, fig.height=5}</span></span>
<span id="cb61-1357"><a href="#cb61-1357" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Snake River"</span></span>
<span id="cb61-1358"><a href="#cb61-1358" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- snakeorder</span></span>
<span id="cb61-1359"><a href="#cb61-1359" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2021,2022)</span></span>
<span id="cb61-1360"><a href="#cb61-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1361"><a href="#cb61-1361" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-1362"><a href="#cb61-1362" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-1363"><a href="#cb61-1363" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-1364"><a href="#cb61-1364" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-1365"><a href="#cb61-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1366"><a href="#cb61-1366" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-1367"><a href="#cb61-1367" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-1368"><a href="#cb61-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1369"><a href="#cb61-1369" aria-hidden="true" tabindex="-1"></a><span class="in"># annual</span></span>
<span id="cb61-1370"><a href="#cb61-1370" aria-hidden="true" tabindex="-1"></a><span class="in">pann &lt;- ggplot() +</span></span>
<span id="cb61-1371"><a href="#cb61-1371" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(data = tempdat, aes(x = logYield, y = ..scaled.., color = site_name, fill = site_name), size = 0.8) +</span></span>
<span id="cb61-1372"><a href="#cb61-1372" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = cet_pal(nsites, name = "i1")) +</span></span>
<span id="cb61-1373"><a href="#cb61-1373" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = alpha(cet_pal(nsites, name = "i1"), 0.1)) +</span></span>
<span id="cb61-1374"><a href="#cb61-1374" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(data = tempdat_big, aes(x = logYield, y = ..scaled..), color = "grey40", fill = alpha("grey40", 0.2), size = 0.8) +</span></span>
<span id="cb61-1375"><a href="#cb61-1375" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Summer log(Yield, mm/day)") + ylab("Density") +</span></span>
<span id="cb61-1376"><a href="#cb61-1376" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), </span></span>
<span id="cb61-1377"><a href="#cb61-1377" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.text.y = element_blank(), axis.ticks.y = element_blank(),</span></span>
<span id="cb61-1378"><a href="#cb61-1378" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.text = element_text(color = "black"), legend.position = "none",</span></span>
<span id="cb61-1379"><a href="#cb61-1379" aria-hidden="true" tabindex="-1"></a><span class="in">                     strip.background = element_blank(), strip.text = element_blank()) +</span></span>
<span id="cb61-1380"><a href="#cb61-1380" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~factor(WaterYear, levels = as.numeric(unlist(pedat %&gt;% arrange(totalyield_sum_z) %&gt;% select(WaterYear)))), ncol = 1)</span></span>
<span id="cb61-1381"><a href="#cb61-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1382"><a href="#cb61-1382" aria-hidden="true" tabindex="-1"></a><span class="in">print(pann)</span></span>
<span id="cb61-1383"><a href="#cb61-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1384"><a href="#cb61-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1385"><a href="#cb61-1385" aria-hidden="true" tabindex="-1"></a><span class="in"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summerdensity_Snake_annual.jpg", width = 2.75, height = 5, units = "in", res = 1000)</span></span>
<span id="cb61-1386"><a href="#cb61-1386" aria-hidden="true" tabindex="-1"></a><span class="in"># pann</span></span>
<span id="cb61-1387"><a href="#cb61-1387" aria-hidden="true" tabindex="-1"></a><span class="in"># dev.off()</span></span>
<span id="cb61-1388"><a href="#cb61-1388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1389"><a href="#cb61-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1390"><a href="#cb61-1390" aria-hidden="true" tabindex="-1"></a>2022/2022 summer flow distributions</span>
<span id="cb61-1391"><a href="#cb61-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=6}</span></span>
<span id="cb61-1392"><a href="#cb61-1392" aria-hidden="true" tabindex="-1"></a><span class="in">bas &lt;- "Snake River"</span></span>
<span id="cb61-1393"><a href="#cb61-1393" aria-hidden="true" tabindex="-1"></a><span class="in">orderr &lt;- snakeorder</span></span>
<span id="cb61-1394"><a href="#cb61-1394" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs &lt;- c(2021,2022)</span></span>
<span id="cb61-1395"><a href="#cb61-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1396"><a href="#cb61-1396" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Watersheds/Snake_Watersheds.shp")</span></span>
<span id="cb61-1397"><a href="#cb61-1397" aria-hidden="true" tabindex="-1"></a><span class="in">mysheds &lt;- mysheds[mysheds$site_id == "SP11",]</span></span>
<span id="cb61-1398"><a href="#cb61-1398" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- vect("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Watershed Delineation/Streams/Snake_Streams.shp")</span></span>
<span id="cb61-1399"><a href="#cb61-1399" aria-hidden="true" tabindex="-1"></a><span class="in">crs(mynet) &lt;- crs(mysheds)</span></span>
<span id="cb61-1400"><a href="#cb61-1400" aria-hidden="true" tabindex="-1"></a><span class="in">mynet &lt;- crop(mynet, mysheds)</span></span>
<span id="cb61-1401"><a href="#cb61-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1402"><a href="#cb61-1402" aria-hidden="true" tabindex="-1"></a><span class="in"># get lakes</span></span>
<span id="cb61-1403"><a href="#cb61-1403" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- get_waterbodies(AOI = siteinfo_sp %&gt;% filter(site_name == "Spread Creek Dam"), buffer = 100000)</span></span>
<span id="cb61-1404"><a href="#cb61-1404" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- st_transform(lakes, crs(mysheds))</span></span>
<span id="cb61-1405"><a href="#cb61-1405" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- st_intersection(lakes, st_as_sf(mysheds))</span></span>
<span id="cb61-1406"><a href="#cb61-1406" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- lakes %&gt;% filter(gnis_name %in% c("Leidy Lake"))</span></span>
<span id="cb61-1407"><a href="#cb61-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1408"><a href="#cb61-1408" aria-hidden="true" tabindex="-1"></a><span class="in"># points</span></span>
<span id="cb61-1409"><a href="#cb61-1409" aria-hidden="true" tabindex="-1"></a><span class="in">mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% snakeorder) %&gt;% mutate(site_name = factor(site_name, levels = snakeorder))</span></span>
<span id="cb61-1410"><a href="#cb61-1410" aria-hidden="true" tabindex="-1"></a><span class="in"># edit geometry to reduce overlap</span></span>
<span id="cb61-1411"><a href="#cb61-1411" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "SF Spread Creek Lower NWIS"] &lt;- st_point(c(-110.32226, 43.76118))</span></span>
<span id="cb61-1412"><a href="#cb61-1412" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "NF Spread Creek Lower"] &lt;- st_point(c(-110.3199, 43.766533))</span></span>
<span id="cb61-1413"><a href="#cb61-1413" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "Grizzly Creek"] &lt;- st_point(c(-110.23289, 43.77433))</span></span>
<span id="cb61-1414"><a href="#cb61-1414" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "NF Spread Creek Upper"] &lt;- st_point(c(-110.23405, 43.77227))</span></span>
<span id="cb61-1415"><a href="#cb61-1415" aria-hidden="true" tabindex="-1"></a><span class="in">st_geometry(mylittleg)[mylittleg$site_name == "SF Spread Creek Upper"] &lt;- st_point(c(-110.31475, 43.73661))</span></span>
<span id="cb61-1416"><a href="#cb61-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1417"><a href="#cb61-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1418"><a href="#cb61-1418" aria-hidden="true" tabindex="-1"></a><span class="in"># filter data</span></span>
<span id="cb61-1419"><a href="#cb61-1419" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat &lt;- dat_clean %&gt;% </span></span>
<span id="cb61-1420"><a href="#cb61-1420" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(basin == bas, !is.na(logYield), Month %in% c(7:9)) %&gt;%</span></span>
<span id="cb61-1421"><a href="#cb61-1421" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(site_name = factor(site_name, levels = orderr))</span></span>
<span id="cb61-1422"><a href="#cb61-1422" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(tempdat$site_name))</span></span>
<span id="cb61-1423"><a href="#cb61-1423" aria-hidden="true" tabindex="-1"></a><span class="in">tempdat_big &lt;- dat_clean_big %&gt;% filter(basin == bas, !is.na(logYield), Month %in% c(7:9), WaterYear %in% unique(tempdat$WaterYear))</span></span>
<span id="cb61-1424"><a href="#cb61-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1425"><a href="#cb61-1425" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate variability for reference gage</span></span>
<span id="cb61-1426"><a href="#cb61-1426" aria-hidden="true" tabindex="-1"></a><span class="in">varbig &lt;- tempdat_big %&gt;% </span></span>
<span id="cb61-1427"><a href="#cb61-1427" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(WaterYear) %&gt;% </span></span>
<span id="cb61-1428"><a href="#cb61-1428" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(bigrange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-1429"><a href="#cb61-1429" aria-hidden="true" tabindex="-1"></a><span class="in">            bigsd = sd(logYield),</span></span>
<span id="cb61-1430"><a href="#cb61-1430" aria-hidden="true" tabindex="-1"></a><span class="in">            bigvar = var(logYield)) %&gt;%</span></span>
<span id="cb61-1431"><a href="#cb61-1431" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-1432"><a href="#cb61-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1433"><a href="#cb61-1433" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate total summer water availability from reference gage</span></span>
<span id="cb61-1434"><a href="#cb61-1434" aria-hidden="true" tabindex="-1"></a><span class="in">#summerflow &lt;- tempdat_big %&gt;% group_by(WaterYear) %&gt;% summarize(summeryield = sum(Yield_mm), summeryield_log = log(sum(Yield_mm))) %&gt;% ungroup()</span></span>
<span id="cb61-1435"><a href="#cb61-1435" aria-hidden="true" tabindex="-1"></a><span class="in">#wateravail2 &lt;- wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z)</span></span>
<span id="cb61-1436"><a href="#cb61-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1437"><a href="#cb61-1437" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate relative variation</span></span>
<span id="cb61-1438"><a href="#cb61-1438" aria-hidden="true" tabindex="-1"></a><span class="in">pedat &lt;- tempdat %&gt;% </span></span>
<span id="cb61-1439"><a href="#cb61-1439" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(basin, WaterYear) %&gt;% </span></span>
<span id="cb61-1440"><a href="#cb61-1440" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(nsites = length(unique(site_name)),</span></span>
<span id="cb61-1441"><a href="#cb61-1441" aria-hidden="true" tabindex="-1"></a><span class="in">            littlerange = range(logYield)[2]-range(logYield)[1],</span></span>
<span id="cb61-1442"><a href="#cb61-1442" aria-hidden="true" tabindex="-1"></a><span class="in">            littlesd = sd(logYield),</span></span>
<span id="cb61-1443"><a href="#cb61-1443" aria-hidden="true" tabindex="-1"></a><span class="in">            littlevar = var(logYield)) %&gt;% </span></span>
<span id="cb61-1444"><a href="#cb61-1444" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb61-1445"><a href="#cb61-1445" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(varbig) %&gt;%</span></span>
<span id="cb61-1446"><a href="#cb61-1446" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pe_range = ((littlerange-bigrange)/bigrange),</span></span>
<span id="cb61-1447"><a href="#cb61-1447" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_sd = ((littlesd-bigsd)/bigsd),</span></span>
<span id="cb61-1448"><a href="#cb61-1448" aria-hidden="true" tabindex="-1"></a><span class="in">         pe_var = ((littlevar-bigvar)/bigvar)) %&gt;%</span></span>
<span id="cb61-1449"><a href="#cb61-1449" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(wateravail %&gt;% select(basin, WaterYear, totalyield, totalyield_z, totalyield_sum, totalyield_sum_z, tyz_perc, tyz_sum_perc)) %&gt;% </span></span>
<span id="cb61-1450"><a href="#cb61-1450" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(WaterYear %in% wtryrs) %&gt;%</span></span>
<span id="cb61-1451"><a href="#cb61-1451" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(wylab = substr(WaterYear, 3, 4)) %&gt;%</span></span>
<span id="cb61-1452"><a href="#cb61-1452" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(totalyield_sum_z)</span></span>
<span id="cb61-1453"><a href="#cb61-1453" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb61-1454"><a href="#cb61-1454" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate annual median summer flow</span></span>
<span id="cb61-1455"><a href="#cb61-1455" aria-hidden="true" tabindex="-1"></a><span class="in">annmed &lt;- tempdat %&gt;%</span></span>
<span id="cb61-1456"><a href="#cb61-1456" aria-hidden="true" tabindex="-1"></a><span class="in">  #filter(WaterYear %in% c(lowyr, highyr)) %&gt;%</span></span>
<span id="cb61-1457"><a href="#cb61-1457" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(site_name, WaterYear) %&gt;%</span></span>
<span id="cb61-1458"><a href="#cb61-1458" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(medlogYield = median(logYield, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb61-1459"><a href="#cb61-1459" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb61-1460"><a href="#cb61-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1461"><a href="#cb61-1461" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange years by total annual yield</span></span>
<span id="cb61-1462"><a href="#cb61-1462" aria-hidden="true" tabindex="-1"></a><span class="in">wtryrs_arranged &lt;- as.numeric(unlist(pedat %&gt;% select(WaterYear)))</span></span>
<span id="cb61-1463"><a href="#cb61-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1464"><a href="#cb61-1464" aria-hidden="true" tabindex="-1"></a><span class="in"># plot it</span></span>
<span id="cb61-1465"><a href="#cb61-1465" aria-hidden="true" tabindex="-1"></a><span class="in">plotlist_wb &lt;- list()</span></span>
<span id="cb61-1466"><a href="#cb61-1466" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(wtryrs_arranged)) {</span></span>
<span id="cb61-1467"><a href="#cb61-1467" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg &lt;- siteinfo_sp %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i]))</span></span>
<span id="cb61-1468"><a href="#cb61-1468" aria-hidden="true" tabindex="-1"></a><span class="in">  mylittleg_sheds &lt;- sheds %&gt;% filter(site_name %in% orderr) %&gt;% left_join(annmed %&gt;% filter(WaterYear == wtryrs_arranged[i])) %&gt;% arrange(desc(area_sqmi))</span></span>
<span id="cb61-1469"><a href="#cb61-1469" aria-hidden="true" tabindex="-1"></a><span class="in">  plotlist_wb[[i]] &lt;- local({</span></span>
<span id="cb61-1470"><a href="#cb61-1470" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- i</span></span>
<span id="cb61-1471"><a href="#cb61-1471" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot() +</span></span>
<span id="cb61-1472"><a href="#cb61-1472" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mysheds), color = "black", fill = "white", linewidth = 0.4) + </span></span>
<span id="cb61-1473"><a href="#cb61-1473" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg_sheds, aes(fill = medlogYield), color = "black") +</span></span>
<span id="cb61-1474"><a href="#cb61-1474" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_fill_viridis(option = "G", direction = 1, limits = range(annmed$medlogYield), na.value = "grey") +</span></span>
<span id="cb61-1475"><a href="#cb61-1475" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "white", linewidth = 1, lineend = "round") +</span></span>
<span id="cb61-1476"><a href="#cb61-1476" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = st_as_sf(mynet), color = "royalblue4", linewidth = 0.6, lineend = "round") +</span></span>
<span id="cb61-1477"><a href="#cb61-1477" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = lakes, color = "white", fill = "lightskyblue1", linewidth = 0.7) +</span></span>
<span id="cb61-1478"><a href="#cb61-1478" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = lakes, color = "royalblue4", fill = "lightskyblue1", linewidth = 0.5) +</span></span>
<span id="cb61-1479"><a href="#cb61-1479" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_sf(data = mylittleg, shape = 21, fill = "white", size = 2) +</span></span>
<span id="cb61-1480"><a href="#cb61-1480" aria-hidden="true" tabindex="-1"></a><span class="in">      labs(fill = "Median\nsummer\nlog(Yield)") + #annotation_scale() +</span></span>
<span id="cb61-1481"><a href="#cb61-1481" aria-hidden="true" tabindex="-1"></a><span class="in">      coord_sf(xlim = range(st_coordinates(mylittleg_sheds)[,1]), ylim = range(st_coordinates(mylittleg_sheds)[,2])) +</span></span>
<span id="cb61-1482"><a href="#cb61-1482" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", axis.text = element_blank()) +</span></span>
<span id="cb61-1483"><a href="#cb61-1483" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_void() + scale_x_continuous(expand = c(0.003, 0.003)) + scale_y_continuous(expand = c(0.002, 0.002))</span></span>
<span id="cb61-1484"><a href="#cb61-1484" aria-hidden="true" tabindex="-1"></a><span class="in">      #annotate("label", x = Inf, y = Inf, label = paste(pedat$WaterYear[i], " (", pedat$tyz_sum_perc[i], "%)", sep = ""), vjust = 1.15, hjust = 1.05, size = 5)</span></span>
<span id="cb61-1485"><a href="#cb61-1485" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb61-1486"><a href="#cb61-1486" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb61-1487"><a href="#cb61-1487" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- ggarrange(plotlist = plotlist_wb, common.legend = TRUE, legend = "right", nrow = 2)</span></span>
<span id="cb61-1488"><a href="#cb61-1488" aria-hidden="true" tabindex="-1"></a><span class="in">print(p)</span></span>
<span id="cb61-1489"><a href="#cb61-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1490"><a href="#cb61-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1491"><a href="#cb61-1491" aria-hidden="true" tabindex="-1"></a><span class="in"># jpeg("C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Presentation figs/EcoD_summermedianmap_Snake_annual.jpg", width = 4, height = 6, units = "in", res = 1000)</span></span>
<span id="cb61-1492"><a href="#cb61-1492" aria-hidden="true" tabindex="-1"></a><span class="in"># p</span></span>
<span id="cb61-1493"><a href="#cb61-1493" aria-hidden="true" tabindex="-1"></a><span class="in"># dev.off()</span></span>
<span id="cb61-1494"><a href="#cb61-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1495"><a href="#cb61-1495" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>